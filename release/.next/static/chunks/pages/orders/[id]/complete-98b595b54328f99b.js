(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1906],{8622:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/orders/[id]/complete",function(){return n(2722)}])},2722:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return OrderCompletePage}});var r=n(5893),o=n(1163),l=n(7294),i=n(3504);function OrderCompletePage(){var e;let t=(0,o.useRouter)(),{id:n}=t.query,[s,d]=(0,l.useState)(null),[a,c]=(0,l.useState)([]),[u,h]=(0,l.useState)(null),[p,f]=(0,l.useState)(!0),[m,x]=(0,l.useState)("");if((0,l.useEffect)(()=>{if(!n)return;let fetchData=async()=>{try{let[e,t,r]=await Promise.all([i.ZP.get("/orders"),i.ZP.get("/orders/".concat(n,"/items")),i.ZP.get("/user")]);if(!t.data.order)throw Error("주문 상세 정보를 찾을 수 없습니다.");if(d(t.data.order),c(t.data.items||[]),h(r.data),await i.ZP.put("/orders/".concat(n)),null==u?void 0:u.id)try{await i.ZP.delete("/cart/items/clear"),console.log("\uD83E\uDDF9 cart_items 초기화 완료")}catch(e){console.warn("❌ cart clear 실패:",e)}}catch(e){console.error("❌ 주문 완료 페이지 오류:",e),x("주문 정보를 불러오는 데 실패했습니다.")}finally{f(!1)}};fetchData()},[n]),(0,l.useEffect)(()=>{let handleBeforeUnload=e=>{e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",handleBeforeUnload),()=>window.removeEventListener("beforeunload",handleBeforeUnload)},[]),p)return(0,r.jsx)("p",{style:{padding:40},children:"⏳ 주문 정보를 불러오는 중입니다..."});if(m)return(0,r.jsx)("p",{style:{padding:40,color:"red"},children:m});let g=a.reduce((e,t)=>e+t.unit_price*t.quantity,0),y=s.total_amount,j=Number(null!==(e=null==s?void 0:s.coupon_discount)&&void 0!==e?e:0);return console.log("\uD83C\uDFAF [OrderCompletePage] 최종 쿠폰 할인액:",j),(0,r.jsxs)("div",{style:{maxWidth:600,margin:"0 auto",padding:32},children:[(0,r.jsx)("h2",{style:{fontSize:24,marginBottom:24},children:"✅ 결제가 완료되었습니다"}),(0,r.jsxs)("div",{style:{border:"1px solid #ccc",borderRadius:12,padding:24,backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[(0,r.jsxs)("p",{style:{fontWeight:"bold",fontSize:18,marginBottom:4},children:["\uD83E\uDDFE 주문번호 #",n]}),(0,r.jsxs)("p",{style:{fontSize:14,color:"#666",marginBottom:16},children:["주문일시: ",new Date(s.created_at).toLocaleString()]}),(0,r.jsxs)("p",{style:{marginBottom:8},children:[(0,r.jsx)("strong",{children:"주문자:"})," ",(null==u?void 0:u.username)||(null==u?void 0:u.email)]}),(0,r.jsx)("hr",{style:{margin:"20px 0"}}),(0,r.jsx)("h4",{style:{fontSize:16,marginBottom:8},children:"\uD83D\uDCE6 주문 상품"}),(0,r.jsx)("ul",{style:{listStyle:"none",padding:0,marginBottom:24},children:a.map(e=>{var n;return console.log("\uD83E\uDDFE 주문 항목:",e),(0,r.jsxs)("li",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[(0,r.jsxs)("span",{style:{color:"#0070f3",cursor:"pointer",textDecoration:"underline"},onClick:()=>{e.schedule_id&&t.push("/schedules/".concat(e.schedule_id))},children:[e.title," x ",e.quantity]}),(0,r.jsx)("span",{children:formatPrice((null!==(n=e.discount_price)&&void 0!==n?n:e.unit_price)*e.quantity)})]},e.id)})}),(0,r.jsxs)("div",{style:{fontSize:15},children:[(0,r.jsxs)("div",{style:rowStyle(),children:[(0,r.jsx)("span",{children:"총 상품금액"}),(0,r.jsx)("span",{children:formatPrice(g)})]}),(0,r.jsxs)("div",{style:rowStyle(),children:[(0,r.jsx)("span",{children:"쿠폰 할인"}),(0,r.jsxs)("span",{children:["- ",formatPrice(j)]})]}),(0,r.jsxs)("div",{style:rowStyle(),children:[(0,r.jsx)("span",{children:"포인트 사용"}),(0,r.jsxs)("span",{children:["- ",formatPrice((null==u?void 0:u.used_point)||0)]})]}),(0,r.jsxs)("div",{style:rowStyle("bold","#111",18,!0),children:[(0,r.jsx)("span",{children:"결제 금액"}),(0,r.jsx)("span",{children:formatPrice(y)})]})]})]}),(0,r.jsx)("p",{style:{marginTop:24,fontSize:14,color:"#555"},children:"\uD83D\uDCAC 결제 정보는 이메일로도 안내됩니다."}),(0,r.jsx)("button",{onClick:()=>t.push("/"),style:{marginTop:16,padding:"10px 16px",backgroundColor:"#333",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold"},children:"\uD83D\uDECD 다시 쇼핑하기"})]})}let rowStyle=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#333",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{display:"flex",justifyContent:"space-between",marginTop:r?12:4,fontWeight:e,color:t,fontSize:n}},formatPrice=e=>"".concat(Number(e).toLocaleString("ko-KR"),"원")}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=8622)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6467],{3409:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/schedules",function(){return n(3653)}])},1451:function(e,t,n){"use strict";n.d(t,{Z:function(){return PageSizeSelector}});var l=n(5893);function PageSizeSelector(e){let{value:t,onChange:n,options:i=[10,20,50,100],style:r={}}=e;return(0,l.jsx)("select",{value:t,onChange:e=>n(Number(e.target.value)),style:{padding:"8px",fontSize:"14px",borderRadius:"6px",...r},children:i.map(e=>(0,l.jsxs)("option",{value:e,children:[e,"개"]},e))})}},9075:function(e,t,n){"use strict";n.d(t,{Z:function(){return PaginationControls}});var l=n(5893);function PaginationControls(e){let{page:t,totalPages:n,onPageChange:i}=e;return(0,l.jsx)("div",{style:{width:"100%",textAlign:"center",marginTop:"16px"},children:(0,l.jsxs)("div",{style:{display:"inline-flex",justifyContent:"center",gap:"12px"},children:[(0,l.jsx)("button",{disabled:1===t,onClick:()=>i(t-1),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:1===t?"#f3f3f3":"#fff",color:"#000",cursor:1===t?"not-allowed":"pointer"},children:"◀"}),(0,l.jsxs)("span",{style:{alignSelf:"center"},children:[t," / ",n||1]}),(0,l.jsx)("button",{disabled:t===n,onClick:()=>i(t+1),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:t===n?"#f3f3f3":"#fff",color:"#000",cursor:t===n?"not-allowed":"pointer"},children:"▶"})]})})}n(7294)},7259:function(e,t,n){"use strict";n.d(t,{Z:function(){return ExcelDownloadButton}});var l=n(5893);function ExcelDownloadButton(e){let{fileName:t,sheetName:i,headers:r,data:s,extraSheets:a=[]}=e,handleDownload=async()=>{let{downloadExcel:e}=await Promise.all([n.e(2251),n.e(4620)]).then(n.bind(n,2260)),l=await Promise.all(a.map(async e=>{let t=await e.fetch();return{name:e.name,data:t}}));e({fileName:t,sheets:[{name:i,headers:r,data:s},...l]})};return(0,l.jsx)("button",{onClick:handleDownload,style:{padding:"8px 12px",backgroundColor:"#217346",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Excel"})}n(7294)},7081:function(e,t,n){"use strict";n.d(t,{Z:function(){return SearchFilter}});var l=n(5893),i=n(1988);function SearchFilter(e){let{searchType:t,setSearchType:n,searchQuery:r,setSearchQuery:s,searchOptions:a=[],onSearchUpdate:o,startDate:d,endDate:c,setStartDate:p,setEndDate:u}=e,h=a.find(e=>e.value===t),x={padding:"8px",fontSize:"14px",borderRadius:"6px",border:"1px solid #ccc"},handleQueryChange=e=>{let n=e.target.value;s(n),o(t,n)};return(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap"},children:[(0,l.jsx)("select",{value:t,onChange:e=>{let t=e.target.value;n(t),s(""),o(t,"")},style:{...x,width:"140px"},children:a.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))}),(null==h?void 0:h.type)==="date"?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.ZP,{selected:d,onChange:e=>p(e),placeholderText:"시작 날짜",dateFormat:"yyyy-MM-dd",customInput:(0,l.jsx)("input",{style:{...x,width:"140px",height:"38px"}})}),(0,l.jsx)(i.ZP,{selected:c,onChange:e=>u(e),placeholderText:"종료 날짜",dateFormat:"yyyy-MM-dd",customInput:(0,l.jsx)("input",{style:{...x,width:"140px",height:"38px"}})})]}):(null==h?void 0:h.type)==="select"&&Array.isArray(h.options)?(0,l.jsxs)("select",{value:r,onChange:handleQueryChange,style:{...x,width:"180px"},children:[(0,l.jsx)("option",{value:"",children:"전체"}),h.options.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))]}):(0,l.jsx)("input",{type:"text",placeholder:"검색어 입력",value:r,onChange:handleQueryChange,style:{...x,width:"240px"}})]})}n(5890)},9018:function(e,t,n){"use strict";n.d(t,{Z:function(){return AdminLayout}});var l=n(5893),i=n(7294),r=n(1163),s=n(2091),a=n(6131);function AdminSidebar(){let e=(0,r.useRouter)(),[t,n]=(0,i.useState)(()=>"true"===localStorage.getItem("sidebar-collapsed")),o={color:"#fff",fontSize:"20px"};return(0,l.jsxs)("nav",{style:{position:"fixed",top:0,left:0,bottom:0,width:t?"60px":"150px",background:"#111827",padding:"10px",overflowY:"auto",display:"flex",flexDirection:"column",height:"100vh",zIndex:1e3},children:[(0,l.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"20px"},children:(0,l.jsx)("button",{onClick:()=>{n(e=>(localStorage.setItem("sidebar-collapsed",!e),!e))},style:{background:"none",border:"none",cursor:"pointer",color:"#fff"},children:t?(0,l.jsx)(s.Dli,{}):(0,l.jsx)(s.bUI,{})})}),(0,l.jsxs)("ul",{style:{padding:0,listStyle:"none",flex:1},children:[(0,l.jsx)("li",{style:{marginBottom:"15px"},children:(0,l.jsxs)("button",{onClick:()=>e.push("/admin"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,l.jsx)(s.xng,{style:o}),!t&&(0,l.jsx)("span",{style:{marginLeft:"10px"},children:"홈"})]})}),(0,l.jsx)("li",{style:{marginBottom:"15px"},children:(0,l.jsxs)("button",{onClick:()=>e.push("/admin/products"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,l.jsx)(s.AFA,{style:o}),!t&&(0,l.jsx)("span",{style:{marginLeft:"10px"},children:"상품관리"})]})}),(0,l.jsx)("li",{style:{marginBottom:"15px"},children:(0,l.jsxs)("button",{onClick:()=>e.push("/admin/schedules"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,l.jsx)(s.IiJ,{style:o}),!t&&(0,l.jsx)("span",{style:{marginLeft:"10px"},children:"교육일정"})]})}),(0,l.jsx)("li",{style:{marginBottom:"15px"},children:(0,l.jsxs)("button",{onClick:()=>e.push("/admin/payments"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,l.jsx)(s.ypE,{style:o}),!t&&(0,l.jsx)("span",{style:{marginLeft:"10px"},children:"결제관리"})]})}),(0,l.jsx)("li",{style:{marginBottom:"15px"},children:(0,l.jsxs)("button",{onClick:()=>e.push("/admin/users"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,l.jsx)(s.Xws,{style:o}),!t&&(0,l.jsx)("span",{style:{marginLeft:"10px"},children:"사용자"})]})}),(0,l.jsx)("li",{style:{marginTop:"auto",paddingTop:"20px",borderTop:"1px solid #555"},children:(0,l.jsx)(a.Z,{collapsed:t})})]})]})}function AdminLayout(e){let{pageTitle:t,children:n}=e;return(0,l.jsxs)("div",{className:"admin-layout",style:{display:"flex",minHeight:"100vh"},children:[(0,l.jsx)(AdminSidebar,{}),(0,l.jsx)("main",{className:"admin-main",style:{flex:1,marginLeft:"150px",overflowY:"auto",backgroundColor:"inherit",height:"100vh"},children:(0,l.jsxs)("div",{style:{padding:"20px"},children:[t&&(0,l.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"bold",marginTop:"0px",marginBottom:"20px"},children:t}),n]})})]})}},3653:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return AdminSchedulesPage}});var l=n(5893),i=n(7294),r=n(1163),s=n(9018),a=n(5616),o=n(7081),d=n(3504),c=n(9075),p=n(1451),u=n(7259);function SchedulesTable(){let e=(0,r.useRouter)(),[t,n]=(0,i.useState)(1),[s,y]=(0,i.useState)(20),[f,g]=(0,i.useState)({key:"start_date",direction:"asc"}),[m,b]=(0,i.useState)("title"),[j,v]=(0,i.useState)(""),[w,_]=(0,i.useState)("전체"),[C,S]=(0,i.useState)([]),[k,D]=(0,i.useState)([]),[A,E]=(0,i.useState)([]),[P,Z]=(0,i.useState)(null),[I,M]=(0,i.useState)(null),formatDateTime=e=>{let t=new Date(e),n=a(t,"yyyy. M. d."),i=a(t,"a h:mm:ss");return(0,l.jsxs)(l.Fragment,{children:[n,(0,l.jsx)("br",{}),i]})},fetchSchedules=async()=>{let e=await d.ZP.get("admin/schedules",{params:{type:w,all:!0,pageSize:s,page:t}});e.data.success&&D(e.data.schedules)};(0,i.useEffect)(()=>{fetchSchedules()},[w]);let handleSort=e=>{let t=f.key===e,l=t&&"asc"===f.direction?"desc":"asc";g({key:e,direction:l}),n(1)},handleDeleteSelected=async()=>{if(window.confirm("정말로 선택한 일정을 삭제하시겠습니까?"))try{await d.ZP.delete("admin/schedules",{data:{ids:A}}),alert("삭제되었습니다."),E([]),fetchSchedules()}catch(e){alert("삭제 실패")}},R=k.length>0&&k.every(e=>A.includes(e.id)),toggleAll=e=>{E(e?k.map(e=>e.id):[])},toggleOne=(e,t)=>{E(n=>t?[...n,e]:n.filter(t=>t!==e))},handleToggleActive=async(e,t)=>{try{await d.ZP.patch("admin/schedules/".concat(e,"/active"),{is_active:!t}),fetchSchedules()}catch(e){alert("상태 변경 실패")}};(0,i.useEffect)(()=>{k.length&&console.log("\uD83D\uDD25 전체 일정 목록",k.map(e=>({id:e.id,is_active:e.is_active,title:e.title})))},[k]),(0,i.useEffect)(()=>{d.ZP.get("admin/schedules/types").then(e=>{e.data.success&&S(e.data.types.map(e=>({label:e,value:e})))})},[]);let L=(0,i.useMemo)(()=>{let e=j.toLowerCase();return k.filter(t=>{var n,l,i,r;if("title"===m)return!j||(null===(n=t.title)||void 0===n?void 0:n.toLowerCase().includes(e));if("product_title"===m)return null===(l=t.product_title)||void 0===l?void 0:l.toLowerCase().includes(e);if("product_type"===m)return null===(i=t.product_type)||void 0===i?void 0:i.toLowerCase().includes(e);if("instructor"===m)return null===(r=t.instructor)||void 0===r?void 0:r.toLowerCase().includes(e);if("price"===m)return String(t.price||"").includes(e);if("is_active"===m)return console.log("is_active 비교:",{value:t.is_active,type:typeof t.is_active,searchQuery:j}),!j||String(t.is_active)===j;if("start_date"===m){if(!P&&!I)return!0;let e=new Date(t.start_date);return!(P&&e<new Date(P)||I&&e>new Date(I))}if("created_at"===m){if(!P&&!I)return!0;let e=new Date(t.created_at);return!(P&&e<new Date(P)||I&&e>new Date(I))}if("updated_at"===m){if(!P&&!I)return!0;if(!t.updated_at)return!1;let e=new Date(t.updated_at);if(P&&e<new Date(P)||I&&e>new Date(I))return!1}return!0})},[k,j,m]),z=(0,i.useMemo)(()=>{let{key:e,direction:t}=f;return[...L].sort((n,l)=>{var i,r;let s=null!==(i=n[e])&&void 0!==i?i:"",a=null!==(r=l[e])&&void 0!==r?r:"";return"number"==typeof s&&"number"==typeof a?"asc"===t?s-a:a-s:"asc"===t?String(s).localeCompare(String(a)):String(a).localeCompare(String(s))})},[L,f]),T=(0,i.useMemo)(()=>Math.ceil(z.length/s),[z,s]),N=(0,i.useMemo)(()=>{let e=(t-1)*s,n=e+s;return z.slice(e,n)},[z,t,s]);return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",flexWrap:"wrap",gap:"12px"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",flex:1},children:[(0,l.jsx)(o.Z,{searchType:m,setSearchType:b,searchQuery:j,setSearchQuery:v,startDate:null,endDate:null,setStartDate:Z,setEndDate:M,onSearchUpdate:(e,t)=>{b(e),v(t),n(1)},searchOptions:[{value:"title",label:"일정명",type:"text"},{value:"product_title",label:"상품명",type:"text"},{value:"product_type",label:"유형",type:"select",options:C},{value:"start_date",label:"기간",type:"date"},{value:"instructor",label:"강사",type:"text"},{value:"price",label:"가격",type:"text"},{value:"is_active",label:"활성화 상태",type:"select",options:[{value:"1",label:"활성"},{value:"0",label:"비활성"}]},{value:"created_at",label:"등록일시",type:"date"},{value:"updated_at",label:"수정일시",type:"date"}]}),(0,l.jsx)("button",{onClick:()=>{n(1),g({key:"start_date",direction:"asc"}),v(""),b("title"),Z(null),M(null),_("전체")},style:{padding:"8px 14px",backgroundColor:"#ccc",border:"none",borderRadius:"6px",cursor:"pointer"},children:"초기화"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,l.jsx)("button",{onClick:handleDeleteSelected,disabled:0===A.length,style:{padding:"8px 12px",backgroundColor:"#ef4444",color:"#fff",border:"none",borderRadius:"6px",fontWeight:"bold",cursor:0===A.length?"not-allowed":"pointer"},children:"삭제"}),(0,l.jsx)(p.Z,{value:s,onChange:e=>{y(e),n(1)}}),(0,l.jsx)(u.Z,{fileName:"일정목록",sheetName:"일정목록",headers:["일정명","상품명","유형","기간","강사","가격","활성화","등록일시","수정일시"],data:z.map(e=>{var t,n;return{일정명:e.title,상품명:e.product_title,유형:e.product_type,기간:"".concat(null===(t=e.start_date)||void 0===t?void 0:t.slice(0,10)," ~ ").concat(null===(n=e.end_date)||void 0===n?void 0:n.slice(0,10)),강사:e.instructor,가격:"".concat(Number(e.price).toLocaleString(),"원"),활성화:e.is_active?"활성":"비활성",등록일시:new Date(e.created_at).toLocaleString(),수정일시:e.updated_at?new Date(e.updated_at).toLocaleString():"-"}}),extraSheets:[{name:"일정별_신청자목록",fetch:async()=>{let e=[];for(let t of z){let n=await d.ZP.get("admin/schedules/".concat(t.id,"/students")),l=n.data.students||[],i=l.map(e=>({일정명:t.title,상품명:t.product_title,이름:e.username,이메일:e.email,수량:e.quantity,구분:e.source,신청일:new Date(e.created_at).toLocaleString()}));e.push(...i)}return e}}]})]})]}),(0,l.jsx)("div",{style:{overflowX:"auto",width:"100%"},children:(0,l.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"15px",lineHeight:"1.6",tableLayout:"fixed"},children:[(0,l.jsx)("thead",{style:{background:"#f9f9f9"},children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{style:{...x,width:"50px"},children:(0,l.jsx)("input",{type:"checkbox",onChange:e=>toggleAll(e.target.checked),checked:R})}),(0,l.jsxs)("th",{style:{...x,width:"280px"},onClick:()=>handleSort("title"),children:["일정명 ",renderArrow("title",f)]}),(0,l.jsx)("th",{style:{...x,width:"80px"},children:"썸네일"}),(0,l.jsxs)("th",{style:{...x,width:"160px"},onClick:()=>handleSort("product_title"),children:["상품명 ",renderArrow("product_title",f)]}),(0,l.jsxs)("th",{style:{...x,width:"120px"},onClick:()=>handleSort("product_type"),children:["유형 ",renderArrow("product_type",f)]}),(0,l.jsxs)("th",{style:{...x,width:"140px"},onClick:()=>handleSort("start_date"),children:["기간 ",renderArrow("start_date",f)]}),(0,l.jsxs)("th",{style:{...x,width:"100px"},onClick:()=>handleSort("instructor"),children:["강사 ",renderArrow("instructor",f)]}),(0,l.jsxs)("th",{style:{...x,width:"100px"},onClick:()=>handleSort("price"),children:["가격 ",renderArrow("price",f)]}),(0,l.jsx)("th",{onClick:()=>handleSort("is_active"),style:{...x,width:"60px",cursor:"pointer",position:"relative"},children:(0,l.jsx)("div",{style:{position:"relative",display:"inline-block",width:"42px",height:"24px"},children:(0,l.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"is_active"!==f.key?"#bbb":"asc"===f.direction?"#bbb":"#28a745",borderRadius:"24px",transition:"0.3s"},children:(0,l.jsx)("div",{style:{position:"absolute",height:"18px",width:"18px",left:"is_active"===f.key&&"desc"===f.direction?"21px":"3px",bottom:"3px",backgroundColor:"white",borderRadius:"50%",transition:"0.3s"}})})})}),(0,l.jsxs)("th",{style:{...x,width:"140px"},onClick:()=>handleSort("created_at"),children:["등록일시 ",renderArrow("created_at",f)]}),(0,l.jsxs)("th",{style:{...x,width:"140px"},onClick:()=>handleSort("updated_at"),children:["수정일시 ",renderArrow("updated_at",f)]})]})}),(0,l.jsx)("tbody",{children:N.map((t,n)=>{var i,r,s;return(0,l.jsxs)("tr",{style:{backgroundColor:n%2==0?"#fff":"#fafafa",borderBottom:"1px solid #eee",textAlign:"center",opacity:t.is_active?1:.4,height:80},children:[(0,l.jsx)("td",{style:{...h,width:"50px"},children:(0,l.jsx)("input",{type:"checkbox",checked:A.includes(t.id),onChange:e=>toggleOne(t.id,e.target.checked)})}),(0,l.jsxs)("td",{style:{...h,width:"280px"},children:[(0,l.jsx)("span",{onClick:()=>e.push("/admin/schedules/".concat(t.id)),style:{color:"#0070f3",textDecoration:"underline",cursor:"pointer",fontWeight:"500",display:"block"},children:t.title}),(0,l.jsx)("span",{style:{fontSize:"13px",color:"#666"},children:null!==(i=t.product_title)&&void 0!==i?i:"-"})]}),(0,l.jsx)("td",{style:{...h,width:"80px"},children:t.image_url?(0,l.jsx)("img",{src:t.image_url,alt:"일정 썸네일",style:{width:60,height:60,objectFit:"cover"}}):t.product_image?(0,l.jsx)("img",{src:t.product_image,alt:"상품 썸네일",style:{width:60,height:60,objectFit:"cover"}}):(0,l.jsx)("div",{style:{height:60,border:"1px dashed #ccc",display:"flex",justifyContent:"center",alignItems:"center",color:"#aaa",fontSize:12,width:"100%"},children:"썸네일 없음"})}),(0,l.jsx)("td",{style:{...h,width:"160px"},children:null!==(r=t.product_title)&&void 0!==r?r:"-"}),(0,l.jsx)("td",{style:{...h,width:"120px"},children:null!==(s=t.product_type)&&void 0!==s?s:"-"}),(0,l.jsx)("td",{style:{...h,width:"140px"},children:(0,l.jsxs)("div",{children:[a(new Date(t.start_date),"yyyy-MM-dd"),(0,l.jsx)("br",{}),"~ ",a(new Date(t.end_date),"yyyy-MM-dd")]})}),(0,l.jsx)("td",{style:{...h,width:"100px"},children:t.instructor}),(0,l.jsx)("td",{style:{...h,width:"100px"},children:null!=t.price?"".concat(Number(t.price).toLocaleString(),"원"):"-"}),(0,l.jsx)("td",{style:{...h,width:"60px"},children:(0,l.jsxs)("div",{onClick:()=>handleToggleActive(t.id,t.is_active),style:{position:"relative",display:"inline-block",width:"42px",height:"24px",cursor:"pointer",overflow:"hidden"},children:[(0,l.jsx)("input",{type:"checkbox",checked:t.is_active,readOnly:!0,style:{opacity:0,width:0,height:0,position:"absolute",pointerEvents:"none"}}),(0,l.jsx)("span",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:t.is_active?"#28a745":"#ccc",borderRadius:"24px",transition:"0.4s"},children:(0,l.jsx)("span",{style:{position:"absolute",width:"18px",height:"18px",left:t.is_active?"21px":"3px",bottom:"3px",backgroundColor:"white",borderRadius:"50%",transition:"0.4s"}})})]})}),(0,l.jsx)("td",{style:{...h,width:"140px"},children:formatDateTime(t.created_at)}),(0,l.jsx)("td",{style:{...h,width:"140px"},children:t.updated_at?formatDateTime(t.updated_at):"-"})]},t.id)})})]})}),(0,l.jsx)(c.Z,{page:t,totalPages:T,onPageChange:n})]})}let h={padding:"12px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",height:"60px",verticalAlign:"middle"},x={...h,fontWeight:"bold",cursor:"pointer"},renderArrow=(e,t)=>{let n={marginLeft:"6px",fontSize:"12px",display:"inline-block",width:"18px",textAlign:"center"};return t.key!==e?(0,l.jsx)("span",{style:{...n,color:"#ccc"},children:"↕"}):(0,l.jsx)("span",{style:{...n,color:"#000"},children:"asc"===t.direction?"▲":"▼"})};function ScheduleModal(e){let{scheduleId:t,onClose:n,onRefresh:r}=e,[s,a]=(0,i.useState)({title:"",product_id:"",start_date:"",end_date:"",location:"",instructor:"",description:"",total_spots:0,price:0}),[o,c]=(0,i.useState)([]),[p,u]=(0,i.useState)(!1),h=!!t;(0,i.useEffect)(()=>{d.ZP.get("admin/products").then(e=>{e.data.success&&c(e.data.products)})},[]),(0,i.useEffect)(()=>{t&&(u(!0),d.ZP.get("admin/schedules/".concat(t)).then(e=>{if(e.data.success){let t=e.data.schedule;a({...t,start_date:t.start_date?new Date(t.start_date).toISOString().slice(0,16):"",end_date:t.end_date?new Date(t.end_date).toISOString().slice(0,16):"",total_spots:Number(t.total_spots)||0,price:Number(t.price)||0})}}).catch(()=>alert("일정 정보를 불러오지 못했습니다.")).finally(()=>u(!1)))},[t]),(0,i.useEffect)(()=>{let handleEsc=e=>{"Escape"===e.key&&n()};return window.addEventListener("keydown",handleEsc),()=>{window.removeEventListener("keydown",handleEsc)}},[n]);let handleSave=async()=>{try{let e={...s,price:Number(s.price)||0,total_spots:Number(s.total_spots)||0},l=h?"put":"post",i=h?"admin/schedules/".concat(t):"admin/schedules",a=await d.ZP[l](i,e);a.data.success?(alert(h?"수정 완료!":"등록 완료!"),null==r||r(),n()):alert("저장 실패: "+a.data.message)}catch(e){console.error("저장 오류:",e),alert("저장 중 오류 발생")}},handleDelete=async()=>{if(h&&t&&confirm("정말로 이 일정을 삭제(숨김처리)하시겠습니까?"))try{let e=await d.ZP.delete("admin/schedules/".concat(t));e.data.success?(alert("삭제 완료"),null==r||r(),n()):alert("삭제 실패: "+e.data.message)}catch(e){console.error("삭제 오류:",e),alert("삭제 중 오류 발생")}},handleChange=e=>{let{name:t,value:n,type:l}=e.target,i="number"===l?""===n?"":Number(n):n;a(e=>({...e,[t]:i}))};return(0,l.jsx)("div",{style:y,children:(0,l.jsxs)("div",{style:f,children:[(0,l.jsx)("h2",{style:{marginBottom:"16px",fontSize:"20px",fontWeight:"bold"},children:h?"일정 수정":"일정 등록"}),(0,l.jsx)("button",{onClick:n,style:w,children:"\xd7"}),p?(0,l.jsx)("p",{children:"⏳ 불러오는 중..."}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:g,children:[(0,l.jsx)("label",{style:m,children:"상품"}),(0,l.jsxs)("select",{name:"product_id",value:s.product_id||"",onChange:handleChange,style:b,children:[(0,l.jsx)("option",{value:"",children:"상품 선택"}),o.map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.title," (",e.type,")"]},e.id))]})]}),(0,l.jsxs)("div",{style:g,children:[(0,l.jsx)("label",{style:m,children:"일정명"}),(0,l.jsx)("input",{name:"title",value:s.title||"",onChange:handleChange,style:b})]}),(0,l.jsxs)("div",{style:g,children:[(0,l.jsx)("label",{style:m,children:"교육기간"}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,l.jsx)("input",{type:"datetime-local",name:"start_date",value:s.start_date||"",onChange:handleChange,style:{...b,flex:1}}),(0,l.jsx)("input",{type:"datetime-local",name:"end_date",value:s.end_date||"",onChange:handleChange,style:{...b,flex:1}})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("label",{style:m,children:"장소"}),(0,l.jsx)("input",{name:"location",value:s.location||"",onChange:handleChange,style:b})]}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("label",{style:m,children:"강사"}),(0,l.jsx)("input",{name:"instructor",value:s.instructor||"",onChange:handleChange,style:b})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("label",{style:m,children:"정원"}),(0,l.jsx)("input",{type:"number",name:"total_spots",value:s.total_spots,onChange:handleChange,style:b})]}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("label",{style:m,children:"가격"}),(0,l.jsx)("input",{type:"number",name:"price",value:s.price,onChange:handleChange,style:b})]})]}),(0,l.jsxs)("div",{style:g,children:[(0,l.jsx)("label",{style:m,children:"설명"}),(0,l.jsx)("textarea",{name:"description",value:s.description||"",onChange:handleChange,rows:3,style:{...b,resize:"vertical"}})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"24px"},children:[h&&(0,l.jsx)("button",{onClick:handleDelete,style:v,children:"삭제"}),(0,l.jsx)("button",{onClick:handleSave,style:j,children:"저장"})]})]})]})})}({...h});let y={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.4)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},f={position:"relative",background:"#fff",padding:"24px 32px",borderRadius:"12px",width:"560px",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 24px rgba(0, 0, 0, 0.2)",fontFamily:"'Noto Sans KR', sans-serif"},g={marginBottom:"16px",display:"flex",flexDirection:"column",gap:"6px"},m={fontWeight:500,fontSize:"14px",marginBottom:"4px"},b={border:"1px solid #ddd",borderRadius:"6px",padding:"8px 10px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"},j={backgroundColor:"#0070f3",color:"#fff",padding:"8px 16px",border:"none",borderRadius:"6px",fontWeight:"bold"},v={backgroundColor:"#e74c3c",color:"#fff",padding:"8px 16px",border:"none",borderRadius:"6px"},w={position:"absolute",top:"12px",right:"16px",fontSize:"18px",fontWeight:"bold",background:"transparent",border:"none",cursor:"pointer",color:"#888"};var _=n(381),C=n(3038);function AdminSchedulesPage(){let e=(0,r.useRouter)(),[t,n]=(0,i.useState)("list"),[a,o]=(0,i.useState)(!1),[c,p]=(0,i.useState)(null),[u,h]=(0,i.useState)([]),[x,y]=(0,i.useState)(_());return(0,i.useEffect)(()=>{if("calendar"!==t)return;let e=x.clone().startOf("month").format("YYYY-MM-DD"),n=x.clone().endOf("month").format("YYYY-MM-DD");d.ZP.get("admin/schedules",{params:{page:1,pageSize:1e3,sort:"start_date",order:"asc",start_date:e,end_date:n}}).then(e=>{if(console.log("\uD83D\uDD25 [API 응답 결과]",e.data),e.data.success){var t,n;let l=e.data.schedules.map(e=>({...e,start:_(e.start_date),end:_(e.end_date),type:e.category}));console.log("\uD83D\uDD25 [변환 후 일정]",l),console.log("✅ start type:",typeof(null===(t=l[0])||void 0===t?void 0:t.start),null===(n=l[0])||void 0===n?void 0:n.start),h(l)}}).catch(()=>{alert("일정 불러오기 실패")})},[t]),(0,l.jsx)(s.Z,{pageTitle:"\uD83D\uDCC5 교육일정",children:(0,l.jsxs)("div",{style:{marginBottom:20},children:[(0,l.jsxs)("div",{style:{position:"relative",marginBottom:"32px"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,l.jsx)("button",{onClick:()=>n("list"),style:{padding:"8px 16px",borderRadius:"6px",border:"1px solid #ccc",backgroundColor:"list"===t?"#0070f3":"#fff",color:"list"===t?"#fff":"#000",fontWeight:"normal",cursor:"pointer"},children:"일정 리스트"}),(0,l.jsx)("button",{onClick:()=>n("calendar"),style:{padding:"8px 16px",borderRadius:"6px",border:"1px solid #ccc",backgroundColor:"calendar"===t?"#0070f3":"#fff",color:"calendar"===t?"#fff":"#000",fontWeight:"normal",cursor:"pointer"},children:"캘린더"})]}),(0,l.jsx)("button",{onClick:()=>e.push("/admin/schedules/new"),style:{padding:"8px 16px",backgroundColor:"#0070f3",color:"#fff",borderRadius:"6px",border:"none",fontWeight:"bold",cursor:"pointer"},children:"+등록"})]}),"calendar"===t&&(0,l.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"18px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"12px",pointerEvents:"none"},children:[(0,l.jsx)("span",{style:{pointerEvents:"auto",cursor:"pointer"},onClick:()=>y(e=>e.clone().subtract(1,"month")),children:"◀"}),(0,l.jsx)("span",{children:x.format("YYYY년 M월")}),(0,l.jsx)("span",{style:{pointerEvents:"auto",cursor:"pointer"},onClick:()=>y(e=>e.clone().add(1,"month")),children:"▶"})]})]}),"list"===t&&(0,l.jsx)(SchedulesTable,{}),"calendar"===t&&(0,l.jsx)(l.Fragment,{children:0===u.length?(0,l.jsx)("div",{style:{padding:"20px",textAlign:"center"},children:"⏳ 일정 데이터를 불러오는 중입니다..."}):(0,l.jsxs)(l.Fragment,{children:[console.log("\uD83D\uDCE6 CustomCalendar에 전달되는 일정",u),(0,l.jsx)(C.Z,{schedules:u,currentMonth:x,setCurrentMonth:y,mode:"admin"})]})}),a&&(0,l.jsx)(ScheduleModal,{scheduleId:c,onClose:()=>{o(!1),p(null)},onRefresh:()=>e.replace(e.asPath)})]})})}}},function(e){e.O(0,[3365,2644,6342,4885,4403,1642,3038,9774,2888,179],function(){return e(e.s=3409)}),_N_E=e.O()}]);
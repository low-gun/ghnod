(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9635],{2257:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return n(3185)}])},1451:function(e,t,n){"use strict";n.d(t,{Z:function(){return PageSizeSelector}});var r=n(5893);function PageSizeSelector(e){let{value:t,onChange:n,options:l=[10,20,50,100],style:o={}}=e;return(0,r.jsx)("select",{value:t,onChange:e=>n(Number(e.target.value)),style:{padding:"8px",fontSize:"14px",borderRadius:"6px",...o},children:l.map(e=>(0,r.jsxs)("option",{value:e,children:[e,"개"]},e))})}},9075:function(e,t,n){"use strict";n.d(t,{Z:function(){return PaginationControls}});var r=n(5893);function PaginationControls(e){let{page:t,totalPages:n,onPageChange:l}=e;return(0,r.jsx)("div",{style:{width:"100%",textAlign:"center",marginTop:"16px"},children:(0,r.jsxs)("div",{style:{display:"inline-flex",justifyContent:"center",gap:"12px"},children:[(0,r.jsx)("button",{disabled:1===t,onClick:()=>l(t-1),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:1===t?"#f3f3f3":"#fff",color:"#000",cursor:1===t?"not-allowed":"pointer"},children:"◀"}),(0,r.jsxs)("span",{style:{alignSelf:"center"},children:[t," / ",n||1]}),(0,r.jsx)("button",{disabled:t===n,onClick:()=>l(t+1),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:t===n?"#f3f3f3":"#fff",color:"#000",cursor:t===n?"not-allowed":"pointer"},children:"▶"})]})})}n(7294)},7259:function(e,t,n){"use strict";n.d(t,{Z:function(){return ExcelDownloadButton}});var r=n(5893);function ExcelDownloadButton(e){let{fileName:t,sheetName:l,headers:o,data:s,extraSheets:i=[]}=e,handleDownload=async()=>{let{downloadExcel:e}=await Promise.all([n.e(2251),n.e(4620)]).then(n.bind(n,2260)),r=await Promise.all(i.map(async e=>{let t=await e.fetch();return{name:e.name,data:t}}));e({fileName:t,sheets:[{name:l,headers:o,data:s},...r]})};return(0,r.jsx)("button",{onClick:handleDownload,style:{padding:"8px 12px",backgroundColor:"#217346",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Excel"})}n(7294)},7081:function(e,t,n){"use strict";n.d(t,{Z:function(){return SearchFilter}});var r=n(5893),l=n(1988);function SearchFilter(e){let{searchType:t,setSearchType:n,searchQuery:o,setSearchQuery:s,searchOptions:i=[],onSearchUpdate:a,startDate:d,endDate:c,setStartDate:u,setEndDate:p}=e,x=i.find(e=>e.value===t),h={padding:"8px",fontSize:"14px",borderRadius:"6px",border:"1px solid #ccc"},handleQueryChange=e=>{let n=e.target.value;s(n),a(t,n)};return(0,r.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap"},children:[(0,r.jsx)("select",{value:t,onChange:e=>{let t=e.target.value;n(t),s(""),a(t,"")},style:{...h,width:"140px"},children:i.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),(null==x?void 0:x.type)==="date"?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.ZP,{selected:d,onChange:e=>u(e),placeholderText:"시작 날짜",dateFormat:"yyyy-MM-dd",customInput:(0,r.jsx)("input",{style:{...h,width:"140px",height:"38px"}})}),(0,r.jsx)(l.ZP,{selected:c,onChange:e=>p(e),placeholderText:"종료 날짜",dateFormat:"yyyy-MM-dd",customInput:(0,r.jsx)("input",{style:{...h,width:"140px",height:"38px"}})})]}):(null==x?void 0:x.type)==="select"&&Array.isArray(x.options)?(0,r.jsxs)("select",{value:o,onChange:handleQueryChange,style:{...h,width:"180px"},children:[(0,r.jsx)("option",{value:"",children:"전체"}),x.options.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]}):(0,r.jsx)("input",{type:"text",placeholder:"검색어 입력",value:o,onChange:handleQueryChange,style:{...h,width:"240px"}})]})}n(5890)},9018:function(e,t,n){"use strict";n.d(t,{Z:function(){return AdminLayout}});var r=n(5893),l=n(7294),o=n(1163),s=n(2091),i=n(6131);function AdminSidebar(){let e=(0,o.useRouter)(),[t,n]=(0,l.useState)(()=>"true"===localStorage.getItem("sidebar-collapsed")),a={color:"#fff",fontSize:"20px"};return(0,r.jsxs)("nav",{style:{position:"fixed",top:0,left:0,bottom:0,width:t?"60px":"150px",background:"#111827",padding:"10px",overflowY:"auto",display:"flex",flexDirection:"column",height:"100vh",zIndex:1e3},children:[(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"20px"},children:(0,r.jsx)("button",{onClick:()=>{n(e=>(localStorage.setItem("sidebar-collapsed",!e),!e))},style:{background:"none",border:"none",cursor:"pointer",color:"#fff"},children:t?(0,r.jsx)(s.Dli,{}):(0,r.jsx)(s.bUI,{})})}),(0,r.jsxs)("ul",{style:{padding:0,listStyle:"none",flex:1},children:[(0,r.jsx)("li",{style:{marginBottom:"15px"},children:(0,r.jsxs)("button",{onClick:()=>e.push("/admin"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,r.jsx)(s.xng,{style:a}),!t&&(0,r.jsx)("span",{style:{marginLeft:"10px"},children:"홈"})]})}),(0,r.jsx)("li",{style:{marginBottom:"15px"},children:(0,r.jsxs)("button",{onClick:()=>e.push("/admin/products"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,r.jsx)(s.AFA,{style:a}),!t&&(0,r.jsx)("span",{style:{marginLeft:"10px"},children:"상품관리"})]})}),(0,r.jsx)("li",{style:{marginBottom:"15px"},children:(0,r.jsxs)("button",{onClick:()=>e.push("/admin/schedules"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,r.jsx)(s.IiJ,{style:a}),!t&&(0,r.jsx)("span",{style:{marginLeft:"10px"},children:"교육일정"})]})}),(0,r.jsx)("li",{style:{marginBottom:"15px"},children:(0,r.jsxs)("button",{onClick:()=>e.push("/admin/payments"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,r.jsx)(s.ypE,{style:a}),!t&&(0,r.jsx)("span",{style:{marginLeft:"10px"},children:"결제관리"})]})}),(0,r.jsx)("li",{style:{marginBottom:"15px"},children:(0,r.jsxs)("button",{onClick:()=>e.push("/admin/users"),style:{display:"flex",alignItems:"center",width:"100%",background:"none",border:"none",cursor:"pointer",color:"#fff"},children:[(0,r.jsx)(s.Xws,{style:a}),!t&&(0,r.jsx)("span",{style:{marginLeft:"10px"},children:"사용자"})]})}),(0,r.jsx)("li",{style:{marginTop:"auto",paddingTop:"20px",borderTop:"1px solid #555"},children:(0,r.jsx)(i.Z,{collapsed:t})})]})]})}function AdminLayout(e){let{pageTitle:t,children:n}=e;return(0,r.jsxs)("div",{className:"admin-layout",style:{display:"flex",minHeight:"100vh"},children:[(0,r.jsx)(AdminSidebar,{}),(0,r.jsx)("main",{className:"admin-main",style:{flex:1,marginLeft:"150px",overflowY:"auto",backgroundColor:"inherit",height:"100vh"},children:(0,r.jsxs)("div",{style:{padding:"20px"},children:[t&&(0,r.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"bold",marginTop:"0px",marginBottom:"20px"},children:t}),n]})})]})}},3185:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return AdminUsersPage}});var r=n(5893),l=n(7294),o=n(1163),s=n(9018);n(5890);var i=n(3504),a=n(7259),d=n(8065);n(7967);var c=n(7081),u=n(9075),p=n(1451);function UserTable(e){let{onResetPassword:t}=e,n=(0,o.useRouter)(),[s,b]=(0,l.useState)([]),[j,v]=(0,l.useState)(0),[C,w]=(0,l.useState)(null),[S,k]=(0,l.useState)("all"),[_,D]=(0,l.useState)(""),[T,A]=(0,l.useState)(null),[E,P]=(0,l.useState)(null),[I,z]=(0,l.useState)(1),[R,B]=(0,l.useState)(20),[O,L]=(0,l.useState)(null),[Z,M]=(0,l.useState)(!1),[N,U]=(0,l.useState)(null),[q,F]=(0,l.useState)([]),[K,H]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(n.query.tab&&"list"!==n.query.tab)return;let e=setTimeout(()=>{fetchUsers()},300);return()=>clearTimeout(e)},[_,S,K,n.query.tab,I,R,C]);let handleResetPassword=async e=>{M(!0);try{await t(e),d.Am.success("비밀번호가 초기화되었습니다.")}catch(e){d.Am.error("비밀번호 초기화 실패")}finally{M(!1),L(null)}},handleSelectOne=e=>{F(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleSort=e=>{let t=C&&C.key===e?{key:e,direction:"asc"===C.direction?"desc":"asc"}:{key:e,direction:"asc"};w(t),z(1)},formatDate=e=>new Date(e).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),renderArrow=e=>{let t={marginLeft:"6px",fontSize:"12px"};return C&&e===C.key?(0,r.jsx)("span",{style:{...t,color:"#000"},children:"ascending"===C.direction?"▲":"▼"}):(0,r.jsx)("span",{style:{...t,color:"#ccc"},children:"↕"})},W=(0,l.useMemo)(()=>{let e=_.toLowerCase();return s.filter(t=>{var n,r,l,o,s,i,a;if("username"===S)return null===(n=t.username)||void 0===n?void 0:n.toLowerCase().includes(e);if("email"===S)return null===(r=t.email)||void 0===r?void 0:r.toLowerCase().includes(e);if("phone"===S)return null===(l=t.phone)||void 0===l?void 0:l.toLowerCase().includes(e);if("role"===S)return null===(o=t.role)||void 0===o?void 0:o.toLowerCase().includes(e);if("created_at"===S){let e=new Date(t.created_at);return(!T||!(e<T))&&(!E||!(e>E))}return(null===(s=t.username)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(i=t.email)||void 0===i?void 0:i.toLowerCase().includes(e))||(null===(a=t.phone)||void 0===a?void 0:a.toLowerCase().includes(e))})},[s,_,S,T,E]),G=(0,l.useMemo)(()=>{if(!C)return W;let{key:e,direction:t}=C;return[...W].sort((n,r)=>{let l=n[e],o=r[e];return l<o?"asc"===t?-1:1:l>o?"asc"===t?1:-1:0})},[W,C]),Q=(0,l.useMemo)(()=>Math.ceil(j/R),[j,R]),handleToggleUserStatus=async(e,t)=>{U(e);try{await i.ZP.put("/admin/users/".concat(e,"/status"),{is_deleted:0===t?1:0}),d.Am.success("계정 상태가 변경되었습니다.");let n=await i.ZP.get("admin/users",{params:{showDeleted:K}});n.data.success&&(b(n.data.users),v(n.data.totalCount))}catch(e){d.Am.error("계정 상태 변경 실패")}finally{U(null)}},fetchUsers=async()=>{try{let e=await i.ZP.get("admin/users",{params:{page:I,pageSize:R,sort:(null==C?void 0:C.key)||"created_at",order:(null==C?void 0:C.direction)||"desc",type:S,search:_,showDeleted:K}});e.data.success&&(b(e.data.users),v(e.data.totalCount))}catch(e){d.Am.error("사용자 목록 조회 실패")}};return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",flexWrap:"wrap",gap:"12px"},children:[(0,r.jsx)(c.Z,{searchType:S,setSearchType:k,searchQuery:_,setSearchQuery:D,searchOptions:[{value:"username",label:"이름",type:"text"},{value:"email",label:"이메일",type:"text"},{value:"phone",label:"전화번호",type:"text"},{value:"role",label:"권한",type:"select",options:[{value:"user",label:"user"},{value:"admin",label:"admin"}]},{value:"created_at",label:"가입일",type:"date"}],startDate:T,endDate:E,setStartDate:A,setEndDate:P,onSearchUpdate:(e,t)=>{k(e),D(t),z(1)}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(0,r.jsxs)("label",{style:{fontSize:"14px",display:"flex",alignItems:"center",gap:"4px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:K,onChange:e=>{H(e.target.checked),z(1)}}),"비활성 포함"]}),(0,r.jsx)(p.Z,{value:R,onChange:e=>{B(e),z(1)}}),(0,r.jsx)(a.Z,{fileName:"회원목록",sheetName:"회원목록",headers:["코드","이름","이메일","전화번호","권한","생성일시","수정일시"],data:G.map(e=>({코드:"user-".concat(e.id),이름:e.username,이메일:e.email,전화번호:e.phone,권한:e.role,생성일시:formatDate(e.created_at),수정일시:formatDate(e.updated_at)}))})]}),(0,r.jsx)("div",{style:{overflowX:"auto",width:"100%"},children:(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"15px",lineHeight:"1.6"},children:[(0,r.jsx)("thead",{style:{background:"#f9f9f9"},children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:h,children:(0,r.jsx)("input",{type:"checkbox",onChange:e=>{if(e.target.checked){let e=s.map(e=>e.id);F(e)}else F([])},checked:q.length>0&&q.length===s.length&&s.every(e=>q.includes(e.id))})}),(0,r.jsx)("th",{style:h,children:"No"}),(0,r.jsxs)("th",{style:h,onClick:()=>handleSort("id"),children:["코드 ",renderArrow("id")]}),(0,r.jsxs)("th",{style:h,onClick:()=>handleSort("username"),children:["이름 ",renderArrow("username")]}),(0,r.jsxs)("th",{style:h,onClick:()=>handleSort("email"),children:["이메일 ",renderArrow("email")]}),(0,r.jsxs)("th",{style:h,onClick:()=>handleSort("phone"),children:["전화번호 ",renderArrow("phone")]}),(0,r.jsxs)("th",{style:h,onClick:()=>handleSort("role"),children:["권한 ",renderArrow("role")]}),(0,r.jsxs)("th",{style:h,onClick:()=>handleSort("created_at"),children:["생성일시 ",renderArrow("created_at")]}),(0,r.jsxs)("th",{style:h,onClick:()=>handleSort("updated_at"),children:["수정일시 ",renderArrow("updated_at")]}),(0,r.jsx)("th",{style:h,children:"비밀번호"}),(0,r.jsx)("th",{style:h,children:"상태"})]})}),(0,r.jsx)("tbody",{children:s.map((e,t)=>(0,r.jsxs)("tr",{style:{backgroundColor:t%2==0?"#fff":"#fafafa"},children:[(0,r.jsx)("td",{style:x,children:(0,r.jsx)("input",{type:"checkbox",checked:q.includes(e.id),onChange:()=>handleSelectOne(e.id)})}),(0,r.jsx)("td",{style:x,children:(I-1)*R+t+1}),(0,r.jsxs)("td",{style:x,children:["user-",e.id]}),(0,r.jsx)("td",{style:{...y,cursor:"pointer"},onClick:()=>n.push("/admin/users/".concat(e.id)),children:e.username}),(0,r.jsx)("td",{style:x,children:e.email}),(0,r.jsx)("td",{style:x,children:e.phone}),(0,r.jsx)("td",{style:x,children:e.role}),(0,r.jsx)("td",{style:x,children:formatDate(e.created_at)}),(0,r.jsx)("td",{style:x,children:formatDate(e.updated_at)}),(0,r.jsx)("td",{style:x,children:(0,r.jsx)("button",{style:m,onClick:()=>L(e),disabled:Z&&O===e.id,children:Z&&O===e.id?"처리 중...":"초기화"})}),(0,r.jsx)("td",{style:x,children:(0,r.jsx)("button",{style:{...m,marginLeft:"8px",backgroundColor:1===Number(e.is_deleted)?"#6c757d":"#e74c3c"},onClick:()=>handleToggleUserStatus(e.id,Number(e.is_deleted)),disabled:N===e.id,children:N===e.id?"처리 중...":1===Number(e.is_deleted)?"복구":"비활성화"})})]},e.id))})]})}),(0,r.jsx)(u.Z,{page:I,totalPages:Q,onPageChange:z}),O&&(0,r.jsx)("div",{style:f,children:(0,r.jsxs)("div",{style:g,children:[(0,r.jsx)("p",{children:"정말 이 사용자의 비밀번호를 초기화하시겠습니까?"}),(0,r.jsxs)("div",{style:{marginTop:"16px",textAlign:"right"},children:[(0,r.jsx)("button",{onClick:()=>L(null),style:{...m,backgroundColor:"#ccc",color:"#000"},children:"취소"}),(0,r.jsx)("button",{onClick:()=>handleResetPassword(O),style:{...m,marginLeft:"8px"},children:"확인"})]})]})})]})})}let x={padding:"12px",textAlign:"center",borderBottom:"1px solid #eee"},h={...x,fontWeight:"bold",cursor:"pointer"},y={...x,color:"#0070f3"},m={padding:"6px 10px",fontSize:"13px",background:"#0070f3",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"},f={position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.3)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:999},g={background:"white",padding:"24px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",width:"360px"};var b=n(7104);function UserPointModal(e){let{user:t,onClose:n,onRefresh:o}=e,[s,a]=(0,l.useState)(""),[d,c]=(0,l.useState)(""),[u,p]=(0,l.useState)([]),[x,h]=(0,l.useState)(1),handleSubmit=async()=>{if(!s)return alert("포인트 금액을 입력해주세요.");try{await i.ZP.post("/admin/batch-points",{userIds:[t.id],amount:Number(s),description:d||"관리자 지급"}),alert("포인트가 지급되었습니다."),a(""),c(""),fetchPointHistory(),o&&o()}catch(e){console.error("❌ 포인트 지급 실패:",e),alert("포인트 지급 중 오류가 발생했습니다.")}},fetchPointHistory=async()=>{try{let e=await i.ZP.get("/admin/users/".concat(t.id,"/points"));e.data.success&&p(e.data.points)}catch(e){console.error("❌ 포인트 내역 조회 실패:",e)}};(0,l.useEffect)(()=>{fetchPointHistory()},[t.id]),(0,l.useEffect)(()=>{let handleKeyDown=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",handleKeyDown),()=>{document.removeEventListener("keydown",handleKeyDown)}},[n]);let y=u.slice((x-1)*5,5*x),m=Math.ceil(u.length/5);return(0,r.jsx)("div",{style:j,children:(0,r.jsxs)("div",{style:v,children:[(0,r.jsx)("button",{onClick:n,style:C,"aria-label":"닫기",children:"\xd7"}),(0,r.jsx)("h3",{style:{marginBottom:"16px"},children:"\uD83D\uDCB0 포인트 지급"}),(0,r.jsxs)("p",{children:["대상: ",(0,r.jsx)("strong",{children:t.username})," (",t.email,")"]}),(0,r.jsxs)("div",{style:{marginTop:"16px"},children:[(0,r.jsx)("label",{children:"포인트 금액"}),(0,r.jsx)("input",{type:"number",placeholder:"예: 1000",value:s,onChange:e=>a(e.target.value),style:w})]}),(0,r.jsxs)("div",{style:{marginTop:"16px"},children:[(0,r.jsx)("label",{children:"지급 사유"}),(0,r.jsx)("input",{type:"text",placeholder:"예: 출석 이벤트 보상",value:d,onChange:e=>c(e.target.value),style:w})]}),(0,r.jsxs)("div",{style:{marginTop:"24px",textAlign:"right"},children:[(0,r.jsx)("button",{onClick:n,style:k,children:"취소"}),(0,r.jsx)("button",{onClick:handleSubmit,style:S,children:"지급"})]}),(0,r.jsx)("h4",{style:{marginTop:"32px"},children:"\uD83D\uDCC4 포인트 내역"}),0===u.length?(0,r.jsx)("p",{style:{marginTop:"8px"},children:"포인트 내역이 없습니다."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("table",{style:{width:"100%",marginTop:"8px",fontSize:"14px"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:_,children:"구분"}),(0,r.jsx)("th",{style:_,children:"금액"}),(0,r.jsx)("th",{style:_,children:"사유"})," ",(0,r.jsx)("th",{style:_,children:"날짜"})]})}),(0,r.jsx)("tbody",{children:y.map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:D,children:e.change_type}),(0,r.jsx)("td",{style:D,children:e.amount}),(0,r.jsx)("td",{style:D,children:e.description||"-"})," ",(0,r.jsx)("td",{style:D,children:new Date(e.created_at).toLocaleDateString()})]},t))})]}),(0,r.jsxs)("div",{style:{marginTop:"12px",textAlign:"center"},children:[(0,r.jsx)("button",{onClick:()=>h(e=>Math.max(e-1,1)),disabled:1===x,children:"◀ 이전"}),(0,r.jsxs)("span",{style:{margin:"0 8px"},children:[x," / ",m||1]}),(0,r.jsx)("button",{onClick:()=>h(e=>Math.min(e+1,m)),disabled:x===m,children:"다음 ▶"})]})]})]})})}let j={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},v={position:"relative",backgroundColor:"#fff",padding:"24px",borderRadius:"8px",width:"500px",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},C={position:"absolute",top:"12px",right:"12px",background:"transparent",border:"none",fontSize:"22px",cursor:"pointer"},w={width:"100%",padding:"8px",fontSize:"14px",borderRadius:"6px",border:"1px solid #ccc",marginTop:"4px"},S={padding:"8px 16px",backgroundColor:"#0070f3",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",marginLeft:"8px"},k={...S,backgroundColor:"#ccc",color:"#000"},_={padding:"8px",borderBottom:"1px solid #ddd",textAlign:"center"},D={padding:"8px",textAlign:"center"};function UserCouponModal(e){let{user:t,onClose:n,onRefresh:o}=e,[s,a]=(0,l.useState)([]),[d,c]=(0,l.useState)(""),[u,p]=(0,l.useState)([]),[x,h]=(0,l.useState)(1);(0,l.useEffect)(()=>{i.ZP.get("/admin/coupon-templates").then(e=>{e.data.success&&a(e.data.data)}).catch(e=>{console.error("❌ 쿠폰 템플릿 불러오기 실패:",e)}),fetchIssuedCoupons();let handleKeyDown=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",handleKeyDown),()=>{document.removeEventListener("keydown",handleKeyDown)}},[]);let fetchIssuedCoupons=async()=>{try{let e=await i.ZP.get("/admin/users/".concat(t.id,"/coupons"));e.data.success&&p(e.data.coupons)}catch(e){console.error("❌ 쿠폰 발급 내역 조회 실패:",e)}},handleSubmit=async()=>{if(!d)return alert("발급할 쿠폰을 선택해주세요.");let e=Number(d);if(!e){alert("쿠폰 템플릿이 유효하지 않습니다.");return}try{await i.ZP.post("/admin/batch-coupons",{userIds:[t.id],templateId:e}),alert("쿠폰이 발급되었습니다."),c(""),fetchIssuedCoupons(),null==o||o()}catch(t){var n,r;let e=(null===(r=t.response)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.message)||t.message||"쿠폰 발급 중 오류가 발생했습니다.";console.error("❌ 쿠폰 발급 실패:",e),alert(e)}},y=u.slice((x-1)*5,5*x),m=Math.ceil(u.length/5),handleRevokeCoupon=async e=>{let t=confirm("정말 이 쿠폰을 회수하시겠습니까?");if(t)try{await i.ZP.delete("/admin/users/coupons/".concat(e)),alert("쿠폰이 성공적으로 회수되었습니다."),fetchIssuedCoupons()}catch(e){console.error("❌ 쿠폰 회수 실패:",e),alert("쿠폰 회수 중 오류가 발생했습니다.")}};return(0,r.jsx)("div",{style:T,children:(0,r.jsxs)("div",{style:A,children:[(0,r.jsx)("button",{onClick:n,style:E,"aria-label":"닫기",children:"\xd7"}),(0,r.jsx)("h3",{style:{marginBottom:"16px"},children:"\uD83C\uDF9F️ 쿠폰 발급"}),(0,r.jsxs)("p",{children:["대상: ",(0,r.jsx)("strong",{children:t.username})," (",t.email,")"]}),(0,r.jsxs)("div",{style:{marginTop:"16px"},children:[(0,r.jsx)("label",{children:"쿠폰 선택"}),(0,r.jsxs)("select",{value:d,onChange:e=>c(e.target.value),style:P,children:[(0,r.jsx)("option",{value:"",children:"선택 안 함"}),s.map(e=>{let t="";return"percent"===e.discount_type&&e.discount_value?t="[".concat(e.discount_value,"%] "):"fixed"===e.discount_type&&e.discount_amount&&(t="[".concat((0,b.T)(e.discount_amount),"원] ")),(0,r.jsxs)("option",{value:e.id,children:[t,e.name]},e.id)})]})]}),(0,r.jsxs)("div",{style:{marginTop:"24px",textAlign:"right"},children:[(0,r.jsx)("button",{onClick:n,style:z,children:"취소"}),(0,r.jsx)("button",{onClick:handleSubmit,style:I,children:"발급"})]}),(0,r.jsx)("h4",{style:{marginTop:"32px"},children:"\uD83D\uDCC4 발급된 쿠폰 내역"}),0===u.length?(0,r.jsx)("p",{style:{marginTop:"8px"},children:"발급된 쿠폰이 없습니다."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("table",{style:{width:"100%",marginTop:"8px",fontSize:"14px"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"쿠폰명"}),(0,r.jsx)("th",{children:"할인"}),(0,r.jsx)("th",{children:"사용여부"}),(0,r.jsx)("th",{children:"만료일"}),(0,r.jsx)("th",{children:"회수"})]})}),(0,r.jsx)("tbody",{children:y.map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.coupon_name||"-"}),(0,r.jsx)("td",{children:"percent"===e.discount_type?"".concat(e.discount_value,"%"):null!=e.discount_amount?"".concat((0,b.T)(e.discount_amount),"원"):"0원"}),(0,r.jsx)("td",{children:1===e.is_used?"사용됨":-1===e.is_used?"회수됨":"미사용"}),(0,r.jsx)("td",{children:e.expiry_date?new Date(e.expiry_date).toLocaleDateString():"-"}),(0,r.jsx)("td",{children:!e.is_used&&(0,r.jsx)("button",{onClick:()=>handleRevokeCoupon(e.id),style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"#dc3545",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:"회수"})})]},t))})]}),(0,r.jsxs)("div",{style:{marginTop:"12px",textAlign:"center"},children:[(0,r.jsx)("button",{onClick:()=>h(e=>Math.max(e-1,1)),disabled:1===x,children:"◀ 이전"}),(0,r.jsxs)("span",{style:{margin:"0 8px"},children:[x," / ",m||1]}),(0,r.jsx)("button",{onClick:()=>h(e=>Math.min(e+1,m)),disabled:x===m,children:"다음 ▶"})]})]})]})})}let T={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},A={position:"relative",backgroundColor:"#fff",padding:"24px",borderRadius:"8px",width:"500px",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},E={position:"absolute",top:"12px",right:"12px",background:"transparent",border:"none",fontSize:"22px",cursor:"pointer"},P={width:"100%",padding:"8px",fontSize:"14px",borderRadius:"6px",border:"1px solid #ccc",marginTop:"4px"},I={padding:"8px 16px",backgroundColor:"#0070f3",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",marginLeft:"8px"},z={...I,backgroundColor:"#ccc",color:"#000"};function CouponTemplateModal(e){let{onClose:t}=e,[n,o]=(0,l.useState)([]),[s,a]=(0,l.useState)(1),[c,p]=(0,l.useState)({name:"",discount_type:"fixed",discount_value:"",discount_amount:"",max_discount_amount:"",expired_at:""});(0,l.useEffect)(()=>{fetchTemplates()},[]);let fetchTemplates=async()=>{try{let e=await i.ZP.get("admin/coupon-templates");e.data.success&&o(e.data.data)}catch(e){console.error("❌ 쿠폰 템플릿 조회 실패:",e),d.Am.error("쿠폰 템플릿 조회 실패")}};(0,l.useEffect)(()=>{fetchTemplates();let handleKeyDown=e=>{"Escape"===e.key&&handleClose()};return document.addEventListener("keydown",handleKeyDown),()=>{document.removeEventListener("keydown",handleKeyDown)}},[]);let handleSubmit=async()=>{if(!c.name||!c.discount_type){d.Am.error("쿠폰명과 할인타입은 필수입니다.");return}if("fixed"===c.discount_type&&!c.discount_amount){d.Am.error("금액 할인 쿠폰은 할인금액이 필요합니다.");return}if("percent"===c.discount_type&&!c.discount_value){d.Am.error("퍼센트 할인 쿠폰은 할인율이 필요합니다.");return}if("percent"===c.discount_type&&c.discount_value>100){d.Am.error("할인율은 100%를 초과할 수 없습니다.");return}try{await i.ZP.post("admin/coupon-templates",{...c,expired_at:c.expired_at||null}),d.Am.success("쿠폰 템플릿이 등록되었습니다."),fetchTemplates(),resetForm()}catch(e){console.error("❌ 쿠폰 템플릿 등록 실패:",e),d.Am.error("등록 실패")}},handleToggleActive=async(e,t)=>{try{await i.ZP.patch("/admin/coupon-templates/".concat(e,"/activate"),{is_active:t?0:1}),fetchTemplates()}catch(e){console.error("❌ 활성화 상태 변경 실패:",e),d.Am.error("상태 변경 실패")}},handleDelete=async e=>{if(window.confirm("정말 삭제하시겠습니까? (발급된 쿠폰이 없어야 합니다)"))try{await i.ZP.delete("/admin/coupon-templates/".concat(e)),d.Am.success("쿠폰 템플릿이 삭제되었습니다."),fetchTemplates()}catch(e){console.error("❌ 쿠폰 템플릿 삭제 실패:",e),d.Am.error("삭제 실패 (발급된 쿠폰이 있을 수 있음)")}},resetForm=()=>{p({name:"",discount_type:"fixed",discount_value:"",discount_amount:"",max_discount_amount:"",expired_at:""})},handleClose=()=>{resetForm(),t()},x=(0,l.useMemo)(()=>{let e=(s-1)*5;return n.slice(e,e+5)},[n,s]);return(0,r.jsx)("div",{style:R,children:(0,r.jsxs)("div",{style:B,children:[(0,r.jsx)("button",{onClick:handleClose,style:O,children:"\xd7"}),(0,r.jsx)("h3",{style:{marginBottom:"16px"},children:"\uD83C\uDF9F️ 쿠폰 템플릿 관리"}),(0,r.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,r.jsxs)("div",{style:L,children:[(0,r.jsx)("label",{style:Z,children:"쿠폰명"}),(0,r.jsx)("input",{type:"text",value:c.name,onChange:e=>p({...c,name:e.target.value}),style:M})]}),(0,r.jsxs)("div",{style:L,children:[(0,r.jsx)("label",{style:Z,children:"할인타입"}),(0,r.jsxs)("select",{value:c.discount_type,onChange:e=>p({...c,discount_type:e.target.value}),style:M,children:[(0,r.jsx)("option",{value:"fixed",children:"금액 할인"}),(0,r.jsx)("option",{value:"percent",children:"퍼센트 할인"})]})]}),"fixed"===c.discount_type?(0,r.jsxs)("div",{style:L,children:[(0,r.jsx)("label",{style:Z,children:"할인금액"}),(0,r.jsx)("input",{type:"number",value:c.discount_amount,onChange:e=>p({...c,discount_amount:e.target.value}),style:M})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:L,children:[(0,r.jsx)("label",{style:Z,children:"할인율(%)"}),(0,r.jsx)("input",{type:"number",value:c.discount_value,max:100,onChange:e=>p({...c,discount_value:e.target.value}),style:M})]}),(0,r.jsxs)("div",{style:L,children:[(0,r.jsx)("label",{style:Z,children:"최대 할인금액"}),(0,r.jsx)("input",{type:"number",value:c.max_discount_amount,onChange:e=>p({...c,max_discount_amount:e.target.value}),style:M})]})]}),(0,r.jsxs)("div",{style:L,children:[(0,r.jsx)("label",{style:Z,children:"만료일"}),(0,r.jsx)("input",{type:"date",value:c.expired_at,onChange:e=>p({...c,expired_at:e.target.value}),style:M})]}),(0,r.jsx)("div",{style:{textAlign:"right",marginTop:"12px"},children:(0,r.jsx)("button",{onClick:handleSubmit,style:N,children:"등록"})})]}),(0,r.jsx)("h4",{children:"\uD83D\uDCC4 등록된 쿠폰 템플릿"}),(0,r.jsxs)("div",{style:{maxHeight:"400px",overflowY:"auto",marginTop:"8px"},children:[(0,r.jsxs)("table",{style:{width:"100%",fontSize:"14px",borderCollapse:"collapse"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:q,children:"쿠폰명"}),(0,r.jsx)("th",{style:q,children:"할인"}),(0,r.jsx)("th",{style:q,children:"만료일"}),(0,r.jsx)("th",{style:q,children:"발급/사용"}),(0,r.jsx)("th",{style:q,children:"상태"}),(0,r.jsx)("th",{style:q,children:"관리"})]})}),(0,r.jsx)("tbody",{children:x.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:F,children:e.name}),(0,r.jsx)("td",{style:F,children:"fixed"===e.discount_type?"".concat((0,b.T)(e.discount_amount),"원"):"".concat(e.discount_value,"%")}),(0,r.jsx)("td",{style:F,children:e.expired_at?new Date(e.expired_at).toLocaleDateString():"만료일 없음"}),(0,r.jsxs)("td",{style:F,children:[e.issued_count||0," / ",e.used_count||0]}),(0,r.jsx)("td",{style:F,children:(0,r.jsx)("button",{onClick:()=>handleToggleActive(e.id,e.is_active),style:{...U,backgroundColor:e.is_active?"#28a745":"#6c757d"},children:e.is_active?"활성화":"비활성화"})}),(0,r.jsx)("td",{style:F,children:(0,r.jsx)("button",{onClick:()=>handleDelete(e.id),style:{...U,backgroundColor:"#e74c3c"},children:"삭제"})})]},e.id))})]}),(0,r.jsx)(u.Z,{page:s,totalPages:Math.ceil(n.length/5),onPageChange:a})]})]})})}let R={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},B={backgroundColor:"#fff",padding:"24px",borderRadius:"8px",width:"720px",maxHeight:"90vh",overflowY:"auto",position:"relative"},O={position:"absolute",top:"8px",right:"12px",background:"transparent",border:"none",fontSize:"24px",cursor:"pointer"},L={display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},Z={width:"120px",textAlign:"left",fontWeight:"bold",fontSize:"14px"},M={flex:"1",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},N={padding:"8px 16px",backgroundColor:"#28a745",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"},U={padding:"4px 8px",fontSize:"13px",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},q={padding:"8px",background:"#f8f9fa",borderBottom:"1px solid #ddd",textAlign:"center",fontWeight:"bold"},F={padding:"8px",borderBottom:"1px solid #eee",textAlign:"center"};function UserPointGrantModal(e){let{selectedIds:t=[],onClose:n,onSuccess:o}=e,[s,a]=(0,l.useState)(0);(0,l.useEffect)(()=>{let handleEsc=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",handleEsc),()=>document.removeEventListener("keydown",handleEsc)},[n]);let handleSubmit=async()=>{if(0===t.length){alert("포인트 지급 대상을 선택해주세요.");return}if(!s||s<=0){d.Am.error("올바른 포인트 금액을 입력해주세요.");return}try{await i.ZP.post("admin/batch-points",{userIds:t,amount:Number(s)}),d.Am.success("포인트 지급이 완료되었습니다."),null==o||o(),n()}catch(e){d.Am.error("포인트 지급 중 오류 발생")}};return(0,r.jsx)("div",{style:K,children:(0,r.jsxs)("div",{style:H,children:[(0,r.jsx)("button",{onClick:n,style:W,children:"\xd7"}),(0,r.jsx)("h3",{style:{marginBottom:12},children:"포인트 지급"}),(0,r.jsxs)("p",{style:{fontSize:14,marginBottom:8},children:["선택된 사용자: ",t.length,"명"]}),(0,r.jsx)("input",{type:"number",value:s,onChange:e=>a(e.target.value),placeholder:"지급할 포인트 금액",style:G}),(0,r.jsx)("div",{style:{textAlign:"right",marginTop:16},children:(0,r.jsx)("button",{onClick:handleSubmit,style:Q,children:"지급"})})]})})}let K={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},H={backgroundColor:"#fff",padding:"24px",borderRadius:"8px",width:"360px",position:"relative"},W={position:"absolute",top:8,right:12,border:"none",background:"transparent",fontSize:24,cursor:"pointer"},G={width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"14px"},Q={padding:"8px 16px",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"};function UserCouponGrantModal(e){let{selectedIds:t=[],couponTemplates:n=[],onClose:o,onSuccess:s}=e,[a,c]=(0,l.useState)("");(0,l.useEffect)(()=>{let handleEsc=e=>{"Escape"===e.key&&o()};return document.addEventListener("keydown",handleEsc),()=>document.removeEventListener("keydown",handleEsc)},[o]);let handleSubmit=async()=>{try{if(console.log("\uD83C\uDFAF 지급 버튼 클릭됨"),0===t.length){alert("쿠폰 지급 대상을 선택해주세요.");return}if(!a){d.Am.error("지급할 쿠폰을 선택해주세요.");return}let e=sessionStorage.getItem("accessToken");console.log("\uD83D\uDD25 accessToken from sessionStorage:",e);let n=await i.ZP.post("admin/batch-coupons",{userIds:t.map(e=>Number(e)),templateId:Number(a)});console.log("✅ 쿠폰 지급 성공 응답:",n.data),d.Am.success("쿠폰 지급이 완료되었습니다."),null==s||s(),o()}catch(l){var e,n,r;console.log("\uD83D\uDCDB 전체 응답 데이터:",null===(e=l.response)||void 0===e?void 0:e.data);let t=(null===(r=l.response)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.message)||l.message||"쿠폰 지급 중 오류 발생";console.error("❌ 쿠폰 지급 실패:",t),d.Am.error(String(t)),alert(t)}};return(0,r.jsx)("div",{style:Y,children:(0,r.jsxs)("div",{style:X,children:[(0,r.jsx)("button",{onClick:o,style:J,children:"\xd7"}),(0,r.jsx)("h3",{style:{marginBottom:12},children:"쿠폰 지급"}),(0,r.jsxs)("p",{style:{fontSize:14,marginBottom:8},children:["선택된 사용자: ",t.length,"명"]}),(0,r.jsxs)("select",{value:a,onChange:e=>c(e.target.value),style:V,children:[(0,r.jsx)("option",{value:"",children:"쿠폰을 선택하세요"}),n.map(e=>{let t="percent"===e.discount_type?"[".concat(e.discount_value,"%] ").concat(e.name):"[".concat(e.discount_amount,"원] ").concat(e.name);return(0,r.jsx)("option",{value:e.id,children:t},e.id)})]}),(0,r.jsx)("div",{style:{textAlign:"right",marginTop:16},children:(0,r.jsx)("button",{onClick:handleSubmit,style:$,children:"지급"})})]})})}let Y={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},X={backgroundColor:"#fff",padding:"24px",borderRadius:"8px",width:"360px",position:"relative"},J={position:"absolute",top:8,right:12,border:"none",background:"transparent",fontSize:24,cursor:"pointer"},V={width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"14px"},$={padding:"8px 16px",backgroundColor:"#ffc107",color:"#212529",border:"none",borderRadius:"6px",cursor:"pointer"};function UserInquiryModal(e){let{userId:t,username:n,onClose:o}=e,[s,a]=(0,l.useState)([]),[d,c]=(0,l.useState)(!0),[u,p]=(0,l.useState)(!1),[x,h]=(0,l.useState)(!0),[y,m]=(0,l.useState)(null),[f,g]=(0,l.useState)("");(0,l.useEffect)(()=>{let fetchInquiries=async()=>{try{let e=await i.ZP.get("/admin/users/".concat(t,"/inquiries"));e.data.success&&a(e.data.inquiries)}catch(e){console.error("문의 목록 조회 실패:",e)}finally{c(!1)}};fetchInquiries()},[t]),(0,l.useEffect)(()=>{let handleEsc=e=>{"Escape"===e.key&&o()};return window.addEventListener("keydown",handleEsc),()=>window.removeEventListener("keydown",handleEsc)},[o]);let formatDate=e=>new Date(e).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}),b=(u?s.filter(e=>!e.answer):s).sort((e,t)=>{let n=new Date(e.created_at).getTime(),r=new Date(t.created_at).getTime();return x?r-n:n-r}),handleSubmitAnswer=async e=>{try{await i.ZP.put("/admin/users/inquiries/".concat(e,"/answer"),{answer:f});let t=s.map(t=>t.id===e?{...t,answer:f,answered_at:new Date().toISOString()}:t);a(t),m(null),g("")}catch(e){alert("답변 등록 실패")}};return(0,r.jsx)("div",{style:ee,children:(0,r.jsxs)("div",{style:et,children:[(0,r.jsx)("button",{onClick:o,style:en,"aria-label":"닫기",children:"\xd7"}),(0,r.jsxs)("h3",{style:{marginBottom:16},children:[n,"님의 문의 내역"]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,r.jsxs)("label",{style:{fontSize:14},children:[(0,r.jsx)("input",{type:"checkbox",checked:u,onChange:e=>p(e.target.checked)}),"\xa0미답변만 보기"]}),(0,r.jsx)("button",{onClick:()=>h(e=>!e),style:{...ed,padding:"4px 10px",fontSize:"12px"},children:x?"\uD83D\uDCC5 최신순":"\uD83D\uDCC5 오래된순"})]}),d?(0,r.jsx)("p",{children:"불러오는 중..."}):0===b.length?(0,r.jsx)("p",{children:"문의 내역이 없습니다."}):(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:b.map(e=>{let t=e.answer?"답변완료":"미답변",n="답변완료"===t?ea.done:ea.pending,l=y===e.id;return(0,r.jsxs)("div",{style:er,children:[(0,r.jsxs)("div",{style:el,children:[(0,r.jsx)("strong",{children:e.title}),(0,r.jsx)("span",{style:n,children:t})]}),(0,r.jsxs)("div",{style:eo,children:[(0,r.jsxs)("span",{children:["작성일: ",formatDate(e.created_at)]}),(0,r.jsxs)("span",{children:["답변일: ",e.answered_at?formatDate(e.answered_at):"-"]})]}),(0,r.jsx)("div",{style:es,children:"\uD83D\uDCE9 문의 내용"}),(0,r.jsx)("p",{style:ei,children:e.message}),e.answer&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:es,children:"✅ 답변 내용"}),(0,r.jsx)("p",{style:ei,children:e.answer})]}),!e.answer&&(0,r.jsx)("div",{style:{marginTop:12},children:l?(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)("textarea",{value:f,onChange:e=>g(e.target.value),placeholder:"답변 내용을 입력하세요",style:{width:"100%",fontSize:13,padding:8,borderRadius:4,border:"1px solid #ccc"}}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[(0,r.jsx)("button",{onClick:()=>m(null),style:{...ed,backgroundColor:"#ccc"},children:"취소"}),(0,r.jsx)("button",{onClick:()=>handleSubmitAnswer(e.id),style:ed,children:"답변 등록"})]})]}):(0,r.jsx)("div",{style:{textAlign:"right"},children:(0,r.jsx)("button",{onClick:()=>m(e.id),style:ed,children:"✏️ 답변하기"})})})]},e.id)})})]})})}let ee={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},et={backgroundColor:"#fff",padding:24,borderRadius:8,width:"700px",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",position:"relative"},en={position:"absolute",top:12,right:12,fontSize:20,background:"transparent",border:"none",color:"#888",cursor:"pointer"},er={border:"1px solid #ddd",borderRadius:8,padding:16,backgroundColor:"#fafafa"},el={display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},eo={display:"flex",justifyContent:"space-between",fontSize:"13px",color:"#666",marginBottom:10},es={fontWeight:"bold",fontSize:"14px",color:"#333",marginBottom:6},ei={fontSize:"14px",lineHeight:1.6,whiteSpace:"pre-line",background:"#fff",border:"1px solid #ddd",borderRadius:4,padding:10},ea={done:{backgroundColor:"#28a745",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"12px"},pending:{backgroundColor:"#dc3545",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"12px"}},ed={padding:"6px 12px",backgroundColor:"#0070f3",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:"13px"};function UserSummaryTable(){let e=(0,o.useRouter)(),[t,n]=(0,l.useState)(0),[s,d]=(0,l.useState)([]),[x,h]=(0,l.useState)("all"),[y,m]=(0,l.useState)(""),[f,g]=(0,l.useState)({key:"username",direction:"asc"}),[j,v]=(0,l.useState)(1),[C,w]=(0,l.useState)(20),[S,k]=(0,l.useState)(null),[_,D]=(0,l.useState)(null),[T,A]=(0,l.useState)(null),[E,P]=(0,l.useState)(null),[I,z]=(0,l.useState)([]),[R,B]=(0,l.useState)([]),[O,L]=(0,l.useState)(!1),[Z,M]=(0,l.useState)(!1),[N,U]=(0,l.useState)(!1);(0,l.useMemo)(()=>{if(!f)return s;let{key:e,direction:t}=f;return[...s].sort((n,r)=>{var l,o;let s=null!==(l=n[e])&&void 0!==l?l:"",i=null!==(o=r[e])&&void 0!==o?o:"";return"number"==typeof s&&"number"==typeof i?"asc"===t?s-i:i-s:"asc"===t?String(s).localeCompare(String(i)):String(i).localeCompare(String(s))})},[s,f]);let q=(0,l.useMemo)(()=>Math.ceil(t/C),[t,C]),fetchSummaries=async()=>{try{let e=await i.ZP.get("admin/users/summary",{params:{page:j,pageSize:C,type:x,search:y,sort:f.key,order:f.direction}});e.data.success&&(d(e.data.summaries),n(e.data.totalCount))}catch(e){console.error("❌ 사용자 요약 데이터 불러오기 실패:",e)}};(0,l.useEffect)(()=>{fetchSummaries()},[x,y,j,C,f]),(0,l.useEffect)(()=>{let fetchCouponTemplates=async()=>{let e=await i.ZP.get("admin/coupon-templates");if(e.data.success){let t=e.data.data.filter(e=>1===e.is_active);B(t)}};fetchCouponTemplates()},[]);let handleSort=e=>{let t=f.key===e&&"asc"===f.direction?"desc":"asc";g({key:e,direction:t}),v(1)},handleSelectOne=e=>{z(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},renderArrow=e=>{let t={marginLeft:6,fontSize:12};return f.key!==e?(0,r.jsx)("span",{style:{...t,color:"#ccc"},children:"↕"}):(0,r.jsx)("span",{style:{...t},children:"asc"===f.direction?"▲":"▼"})};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"16px",flexWrap:"wrap",gap:"12px"},children:[(0,r.jsx)(c.Z,{searchType:x,setSearchType:h,searchQuery:y,setSearchQuery:m,searchOptions:[{value:"username",label:"이름",type:"text"},{value:"email",label:"이메일",type:"text"},{value:"courseCount",label:"수강",type:"text"},{value:"pointTotal",label:"포인트",type:"text"},{value:"paymentTotal",label:"결제",type:"text"},{value:"couponCount",label:"쿠폰",type:"text"},{value:"inquiryCount",label:"문의",type:"text"}],onSearchUpdate:(e,t)=>{h(e),m(t),v(1)}}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,r.jsx)("button",{onClick:()=>U(!0),style:{padding:"8px 16px",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"},children:"포인트 지급"}),(0,r.jsx)("button",{onClick:()=>{if(0===I.length){alert("지급 대상을 먼저 선택해주세요.");return}M(!0)},style:{padding:"8px 16px",backgroundColor:"#ffc107",color:"#212529",border:"none",borderRadius:"6px",cursor:"pointer"},children:"쿠폰 지급"}),(0,r.jsx)("button",{onClick:()=>L(!0),style:{padding:"8px 16px",backgroundColor:"#28a745",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"},children:"쿠폰관리"}),(0,r.jsx)(p.Z,{value:C,onChange:e=>{w(e),v(1)}}),(0,r.jsx)(a.Z,{fileName:"사용자별_구매내역",sheetName:"사용자요약",headers:["이름","이메일","수강횟수","적립포인트","사용포인트","잔여포인트","결제합계","잔여쿠폰","문의내역"],data:s.map(e=>({이름:e.username,이메일:e.email,수강횟수:e.courseCount,적립포인트:e.pointGiven,사용포인트:e.pointUsed,잔여포인트:e.pointBalance,결제합계:e.paymentTotal,잔여쿠폰:e.couponBalance,문의내역:e.inquiryCount}))})]})]}),O&&(0,r.jsx)(CouponTemplateModal,{onClose:()=>L(!1)}),0===s.length?(0,r.jsx)("p",{children:"사용자 요약 정보가 없습니다."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("table",{style:ec,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:eu,children:(0,r.jsx)("input",{type:"checkbox",onChange:e=>{z(e.target.checked?s.map(e=>e.id):[])},checked:I.length===s.length&&s.length>0})}),(0,r.jsx)("th",{style:eu,children:"No"}),(0,r.jsxs)("th",{style:eu,onClick:()=>handleSort("username"),children:["이름 ",renderArrow("username")]}),(0,r.jsxs)("th",{style:eu,onClick:()=>handleSort("email"),children:["이메일 ",renderArrow("email")]}),(0,r.jsxs)("th",{style:eu,onClick:()=>handleSort("courseCount"),children:["수강 ",renderArrow("courseCount")]}),(0,r.jsxs)("th",{style:eu,onClick:()=>handleSort("paymentTotal"),children:["결제합계 ",renderArrow("paymentTotal")]}),(0,r.jsxs)("th",{style:eu,onClick:()=>handleSort("pointBalance"),children:["잔여포인트 ",renderArrow("pointBalance")]}),(0,r.jsxs)("th",{style:eu,onClick:()=>handleSort("couponCount"),children:["잔여쿠폰 ",renderArrow("couponCount")]}),(0,r.jsxs)("th",{style:eu,onClick:()=>handleSort("inquiryCount"),children:["문의 ",renderArrow("inquiryCount")]})]})}),(0,r.jsx)("tbody",{children:s.map((t,n)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:ep,children:(0,r.jsx)("input",{type:"checkbox",checked:I.includes(t.id),onChange:()=>handleSelectOne(t.id)})}),(0,r.jsx)("td",{style:ep,children:(j-1)*C+n+1}),(0,r.jsx)("td",{style:{...ep,color:"#0070f3",cursor:"pointer"},onClick:()=>e.push("/admin/users/".concat(t.id)),children:t.username}),(0,r.jsx)("td",{style:ep,children:t.email}),(0,r.jsxs)("td",{style:ep,children:[t.courseCount,"건"]}),(0,r.jsx)("td",{style:ep,children:(0,b.T)(t.paymentTotal)}),(0,r.jsx)("td",{style:{...ep,color:"#0070f3",cursor:"pointer"},onClick:()=>D(t),children:(0,b.T)(t.pointBalance)}),(0,r.jsxs)("td",{style:{...ep,color:"#0070f3",cursor:"pointer"},onClick:()=>A(t),children:[t.couponBalance,"장"]}),(0,r.jsxs)("td",{style:{...ep,color:"#0070f3",cursor:"pointer"},onClick:()=>P(t),children:[t.inquiryCount,"건"]})]},t.id))})]}),(0,r.jsx)(u.Z,{page:j,totalPages:q,onPageChange:v})]}),S&&(0,r.jsx)(UserRewardModal,{user:S,onClose:()=>k(null)})," ",_&&(0,r.jsx)(UserPointModal,{user:_,onClose:()=>D(null),onRefresh:fetchSummaries}),T&&(0,r.jsx)(UserCouponModal,{user:T,onClose:()=>A(null),onRefresh:fetchSummaries}),E&&(0,r.jsx)(UserInquiryModal,{userId:E.id,username:E.username,onClose:()=>P(null)}),N&&(0,r.jsx)(UserPointGrantModal,{selectedIds:I,onClose:()=>U(!1),onSuccess:()=>{fetchSummaries(),z([])}}),Z&&(0,r.jsx)(UserCouponGrantModal,{selectedIds:I,couponTemplates:R,onClose:()=>M(!1),onSuccess:()=>{fetchSummaries(),z([])}})]})}let ec={width:"100%",borderCollapse:"collapse",fontSize:"15px",lineHeight:"1.6"},eu={padding:"12px",textAlign:"center",fontWeight:"bold",cursor:"pointer"},ep={padding:"12px",textAlign:"center"};var ex=n(7066),eh=n(4027);function AdminUsersPage(){let e=(0,o.useRouter)(),{query:t}=e,{user:n}=(0,l.useContext)(eh.St),[i,a]=(0,l.useState)(!1),d=t.tab||"list",[c,u]=(0,l.useState)(d),[p,x]=(0,l.useState)("");(0,l.useEffect)(()=>{t.tab||e.replace({pathname:e.pathname,query:{...t,tab:d}})},[t.tab]),(0,l.useEffect)(()=>{t.tab&&u(t.tab)},[t.tab]),(0,l.useEffect)(()=>{n&&"admin"!==n.role&&e.replace("/")},[n,e]);let handleResetPassword=async e=>{let t=window.confirm("사용자 [".concat(e.username," / ").concat(e.email,"]의 비밀번호를 [1234]로 초기화하시겠습니까?"));if(t)try{let t=await ex.Z.put("/api/admin/users/".concat(e.id,"/reset-password"));t.data.success?alert("비밀번호가 [1234]로 초기화되었습니다."):alert("초기화에 실패했습니다.")}catch(e){console.error("❌ 초기화 오류:",e),alert("초기화 중 오류가 발생했습니다.")}};return n&&"admin"===n.role?(0,r.jsx)(s.Z,{pageTitle:"사용자 관리",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[(0,r.jsx)("button",{onClick:()=>{e.push({pathname:e.pathname,query:{...e.query,tab:"list"}})},style:"list"===c?em:ey,children:"사용자 목록"}),(0,r.jsx)("button",{onClick:()=>{e.push({pathname:e.pathname,query:{...e.query,tab:"summary"}})},style:"summary"===c?em:ey,children:"사용자별 구매내역"})]}),p&&(0,r.jsx)("p",{style:{color:"red"},children:p}),!p&&"list"===c&&(0,r.jsx)(UserTable,{onResetPassword:handleResetPassword}),!p&&"summary"===c&&(0,r.jsx)(UserSummaryTable,{})]})}):null}let ey={padding:"8px 16px",backgroundColor:"#f5f5f5",border:"1px solid #ccc",borderRadius:"4px",cursor:"pointer"},em={...ey,backgroundColor:"#0070f3",color:"white",fontWeight:"bold"}},5054:function(e,t,n){"use strict";n.d(t,{w_:function(){return GenIcon}});var r=n(7294),l={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},o=r.createContext&&r.createContext(l),s=["attr","size","title"];function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){var r,l;r=t,l=n[t],(r=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(r))in e?Object.defineProperty(e,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[r]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function GenIcon(e){return t=>r.createElement(IconBase,_extends({attr:_objectSpread({},e.attr)},t),function Tree2Element(e){return e&&e.map((e,t)=>r.createElement(e.tag,_objectSpread({key:t},e.attr),Tree2Element(e.child)))}(e.child))}function IconBase(e){var elem=t=>{var n,{attr:l,size:o,title:i}=e,a=function(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,s),d=o||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),r.createElement("svg",_extends({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,l,a,{className:n,style:_objectSpread(_objectSpread({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==o?r.createElement(o.Consumer,null,e=>elem(e)):elem(l)}}},function(e){e.O(0,[3365,2644,6342,4403,9774,2888,179],function(){return e(e.s=2257)}),_N_E=e.O()}]);
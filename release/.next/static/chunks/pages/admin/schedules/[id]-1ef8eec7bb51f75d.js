(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9607],{3506:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/schedules/[id]",function(){return a(2905)}])},2905:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ScheduleFormPage}});var i=a(5893),l=a(1163),r=a(7294),n=a(3504),d=a(9018),o=a(489);function CertificateTemplateModal(e){let{visible:t,onClose:a,onSave:l,initialValue:d,initialBackgroundUrl:o}=e,[m,y]=(0,r.useState)(d||""),[b,v]=(0,r.useState)(o||""),[j,_]=(0,r.useState)(!1),[C,w]=(0,r.useState)("portrait"),[k,S]=(0,r.useState)(1),[R,T]=(0,r.useState)(""),[D,E]=(0,r.useState)(!0);if((0,r.useEffect)(()=>{let recalc=()=>{let e="portrait"===C?794:1123,t="portrait"===C?1123:794,a=(.7*window.innerHeight-48)/t;S(Math.min(900/e,a))};return recalc(),window.addEventListener("resize",recalc),()=>window.removeEventListener("resize",recalc)},[C]),!t)return null;let handleUploadBackground=async e=>{let t=e.target.files[0];if(!t)return;let a=new FormData;a.append("file",t);try{let e=await n.ZP.post("admin/certificates/upload",a,{headers:{"Content-Type":"multipart/form-data"}});if(e.data.success){var i;let t=((i="http://localhost:5001/api",void 0===i)?void 0:i.replace("/api",""))||"",a="".concat(t).concat(e.data.url);v(a),alert("배경이미지 업로드 완료!")}else alert("업로드 실패")}catch(e){console.error("❌ 배경이미지 업로드 오류:",e),alert("업로드 중 오류 발생")}};(0,r.useEffect)(()=>{if(!t)return;let onKeyDown=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",onKeyDown),()=>window.removeEventListener("keydown",onKeyDown)},[t,a]);let L=r.useMemo(()=>m.replace(/padding:\s*\d+(\.\d+)?px;?/gi,""),[m]);return(0,i.jsx)("div",{style:s,children:(0,i.jsxs)("div",{style:c,children:[(0,i.jsx)("button",{onClick:a,style:p,"aria-label":"닫기",children:"\xd7"}),(0,i.jsxs)("h2",{style:{marginBottom:"16px"},children:["수료증 템플릿 ",d?"수정":"등록"]}),(0,i.jsxs)("div",{style:{marginBottom:"12px",display:"flex",gap:"8px",alignItems:"center"},children:[(0,i.jsx)("button",{onClick:()=>w("portrait"),style:{...u,backgroundColor:"portrait"===C?"#0070f3":"#ccc",color:"portrait"===C?"#fff":"#000"},children:"세로형"}),(0,i.jsx)("button",{onClick:()=>w("landscape"),style:{...u,backgroundColor:"landscape"===C?"#0070f3":"#ccc",color:"landscape"===C?"#fff":"#000"},children:"가로형"}),(0,i.jsxs)("label",{style:{marginLeft:"auto",fontSize:"14px"},children:[(0,i.jsx)("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:handleUploadBackground}),(0,i.jsx)("span",{style:{padding:"8px 12px",backgroundColor:"#10b981",color:"#fff",borderRadius:"6px",cursor:"pointer"},children:"배경 업로드"})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"16px",marginTop:"10px",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{fontSize:"14px",fontWeight:"bold"},children:"다운로드 시작일:"}),(0,i.jsx)("input",{type:"date",value:R,onChange:e=>T(e.target.value),style:{marginLeft:"8px",padding:"6px",border:"1px solid #ccc",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[(0,i.jsx)("label",{style:{fontSize:"14px",marginRight:"8px"},children:"활성화:"}),(0,i.jsx)("input",{type:"checkbox",checked:D,onChange:e=>E(e.target.checked),style:{width:"20px",height:"20px"}})]})]}),j?(0,i.jsx)("div",{style:x,children:(0,i.jsx)("div",{style:{width:("portrait"===C?794:1123)*k,height:("portrait"===C?1123:794)*k,background:b?"url('".concat(b,"') no-repeat center/cover"):"#fff",boxShadow:"0 0 10px rgba(0,0,0,0.3)",padding:0,boxSizing:"border-box",overflow:"hidden"},dangerouslySetInnerHTML:{__html:L}})}):(0,i.jsx)("textarea",{value:m,onChange:e=>y(e.target.value),placeholder:"여기에 수료증 HTML 코드를 입력하세요",style:h}),(0,i.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,i.jsx)("button",{onClick:()=>_(!j),style:f,children:j?"코드 수정":"미리보기"}),(0,i.jsx)("button",{onClick:()=>{if(!m.trim()){alert("HTML 코드를 입력하세요.");return}l({html:m,backgroundUrl:b,release_date:R,is_active:D})},style:g,children:"저장"})]})]})})}let s={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},c={position:"relative",width:"960px",maxHeight:"90vh",height:"90vh",backgroundColor:"#fff",padding:"24px",borderRadius:"8px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},p={position:"absolute",top:"12px",right:"12px",background:"transparent",border:"none",fontSize:"24px",cursor:"pointer"},u={padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer"},h={width:"100%",height:"400px",padding:"12px",fontSize:"14px",borderRadius:"6px",border:"1px solid #ccc",fontFamily:"monospace",resize:"vertical"},x={flex:1,background:"#f9f9f9",marginTop:16,paddingTop:24,paddingBottom:24,display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},g={padding:"10px 20px",marginLeft:"10px",backgroundColor:"#0070f3",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer"},f={padding:"10px 20px",backgroundColor:"#ccc",color:"#000",border:"none",borderRadius:"6px",cursor:"pointer"};function ScheduleFormPage(){var e;let t=(0,l.useRouter)(),{id:a}=t.query,s="new"!==a,formatDateTimeLocal=e=>e?e.replace(" ","T").slice(0,16):"",[c,p]=(0,r.useState)({product_id:"",title:"",start_date:"",end_date:"",location:"",instructor:"",description:"",total_spots:0,price:0,detail:"",image_url:""}),[u,h]=(0,r.useState)(!1),[x,g]=(0,r.useState)([]),[f,m]=(0,r.useState)(!1),[y,b]=(0,r.useState)("");(0,r.useEffect)(()=>{n.ZP.get("admin/products").then(e=>{e.data.success&&g(e.data.products)})},[]),(0,r.useEffect)(()=>{s&&a&&(m(!0),n.ZP.get("admin/schedules/".concat(a)).then(e=>{if(e.data.success){let t=e.data.schedule;p({...t,start_date:formatDateTimeLocal(t.start_date),end_date:formatDateTimeLocal(t.end_date),total_spots:Number(t.total_spots)||0,price:Number(t.price)||0,image_url:t.image_url||""})}else alert("일정 정보를 불러오지 못했습니다.")}).catch(()=>alert("일정 정보를 불러오지 못했습니다.")).finally(()=>m(!1)))},[a,s]);let handleChange=e=>{let{name:t,value:a,type:i}=e.target,l="number"===i?""===a?"":Number(a):a;if("product_id"===t){let e=x.find(e=>e.id===Number(a));p(a=>{var i;return{...a,[t]:l,title:(null==e?void 0:e.title)||"",price:null!==(i=null==e?void 0:e.price)&&void 0!==i?i:0,description:(null==e?void 0:e.description)||"",detail:(null==e?void 0:e.detail)||"",image_url:(null==e?void 0:e.image_url)||""}}),b((null==e?void 0:e.image_url)||"")}else p(e=>({...e,[t]:l}))},validate=()=>c.title?c.product_id?c.start_date&&c.end_date?new Date(c.start_date)>new Date(c.end_date)?"종료일은 시작일보다 늦어야 합니다.":""===c.price||null===c.price||void 0===c.price?"가격을 입력하세요.":null:"시작일과 종료일을 입력하세요.":"상품을 선택하세요.":"일정명을 입력하세요.",handleSave=async()=>{let e=validate();if(e)return alert(e);console.log("저장 전 form 확인:",c),console.log("\uD83D\uDCE6 저장 요청 payload:",c);try{let e=s?"put":"post",i=s?"admin/schedules/".concat(a):"admin/schedules",l=await n.ZP[e](i,c);console.log("\uD83D\uDCE5 서버 응답:",l.data),l.data.success?(alert(s?"수정 완료!":"등록 완료!"),t.push("/admin/schedules")):alert("저장 실패: "+l.data.message)}catch(e){console.error("저장 오류:",e),alert("저장 중 오류 발생")}},handleDelete=async()=>{if(s&&a&&confirm("정말로 이 일정을 삭제하시겠습니까?"))try{let e=await n.ZP.delete("admin/schedules/".concat(a));e.data.success?(alert("삭제 완료"),t.push("admin/schedules")):alert("삭제 실패: "+e.data.message)}catch(e){console.error("삭제 오류:",e),alert("삭제 중 오류 발생")}};if(!t.isReady)return null;let handleSaveCertificateTemplate=async e=>{let{html:t,backgroundUrl:i,release_date:l,is_active:r}=e;try{let e=await n.ZP.put("admin/schedules/".concat(a,"/certificate-template"),{certificate_template:t,certificate_background_url:i||null,certificate_release_date:l||null,certificate_is_active:r?1:0});e.data.success?(alert("수료증 템플릿이 저장되었습니다."),p(e=>({...e,certificate_template:t,certificate_background_url:i||null,certificate_release_date:l||null,certificate_is_active:r?1:0})),h(!1)):alert("수료증 템플릿 저장 실패: "+e.data.message)}catch(e){console.error("❌ 수료증 템플릿 저장 오류:",e),alert("저장 중 오류가 발생했습니다.")}};return(0,i.jsx)(d.Z,{pageTitle:s?"일정수정":"일정등록",children:(0,i.jsxs)("div",{style:{width:960,marginLeft:0,marginRight:"auto",padding:32,background:"#fff",borderRadius:12,boxShadow:"0 0 12px rgba(0,0,0,0.05)"},children:[f?(0,i.jsx)("p",{children:"⏳ 불러오는 중..."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"flex",gap:32},children:[(0,i.jsxs)("div",{style:{width:300,display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[(0,i.jsxs)("label",{htmlFor:"image-upload",style:{width:"100%",height:300,border:"2px solid #999",borderRadius:8,display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",cursor:"pointer"},children:[c.image_url?(0,i.jsx)("img",{src:c.image_url,alt:"썸네일",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("span",{style:{color:"#777",fontSize:14},children:"[이미지 업로드]"}),(0,i.jsx)("input",{id:"image-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{let t=e.target.files[0];if(!t)return;let a=new FileReader;a.onload=()=>{p(e=>({...e,image_url:a.result}))},a.readAsDataURL(t)}})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[c.image_url&&c.image_url!==y&&(0,i.jsx)("span",{style:{fontSize:12,color:"#e67e22",fontWeight:"bold",background:"#fdf2e9",padding:"2px 6px",borderRadius:4},children:"변경됨"}),(0,i.jsx)("button",{type:"button",onClick:()=>p(e=>({...e,image_url:y})),style:{fontSize:12,padding:"4px 8px",border:"1px solid #ccc",backgroundColor:"#fff",borderRadius:4,cursor:"pointer"},children:"초기화"})]})]}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)("label",{children:"상품"}),(0,i.jsxs)("select",{name:"product_id",value:c.product_id||"",onChange:handleChange,style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ccc"},children:[(0,i.jsx)("option",{value:"",children:"교육 상품 선택"}),x.filter(e=>"교육"===e.category).map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.title," (",e.type,")"]},e.id))]})]}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)("label",{children:"일정명"}),(0,i.jsx)("input",{name:"title",value:c.title||"",onChange:e=>p(t=>({...t,title:e.target.value})),type:"text",style:{width:"100%",padding:10,border:"1px solid #ccc",borderRadius:6,color:(null===(e=x.find(e=>e.id===Number(c.product_id)))||void 0===e?void 0:e.title)===c.title?"#aaa":"#000"}})]}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)("label",{children:"장소"}),(0,i.jsx)("input",{name:"location",value:c.location||"",onChange:handleChange,type:"text",style:{width:"100%",padding:10,border:"1px solid #ccc",borderRadius:6,fontFamily:"inherit"}})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:16},children:[(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("label",{children:"강사"}),(0,i.jsx)("input",{name:"instructor",value:c.instructor||"",onChange:handleChange,type:"text",style:{width:"100%",padding:10,border:"1px solid #ccc",borderRadius:6,fontFamily:"inherit"}})]}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("label",{children:"정원"}),(0,i.jsx)("input",{name:"total_spots",value:c.total_spots,onChange:handleChange,type:"number",style:{width:"100%",padding:10,border:"1px solid #ccc",borderRadius:6,fontFamily:"inherit"}})]})]}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)("label",{children:"교육기간"}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("input",{name:"start_date",value:c.start_date,onChange:handleChange,type:"datetime-local",style:{flex:1,padding:10,border:"1px solid #ccc",borderRadius:6,fontFamily:"inherit"}}),(0,i.jsx)("span",{style:{alignSelf:"center"},children:"~"}),(0,i.jsx)("input",{name:"end_date",value:c.end_date,onChange:handleChange,type:"datetime-local",style:{flex:1,padding:10,border:"1px solid #ccc",borderRadius:6,fontFamily:"inherit"}})]})]}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)("label",{children:"가격"}),(0,i.jsx)("input",{name:"price",value:c.price,onChange:handleChange,type:"number",style:{width:"100%",padding:10,border:"1px solid #ccc",borderRadius:6,fontFamily:"inherit"}})]})]})]}),(0,i.jsxs)("div",{style:{marginTop:40},children:[(0,i.jsx)("label",{style:{display:"block",fontWeight:600,marginBottom:8},children:"상세 설명"}),(0,i.jsx)(o.Z,{value:c.detail,onChange:e=>p(t=>({...t,detail:e})),height:280})]}),(0,i.jsx)("hr",{style:{margin:"40px 0",border:"none",borderTop:"1px solid #eee"}}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:10,marginTop:32},children:[(0,i.jsx)("button",{onClick:()=>t.push("admin/schedules"),style:{padding:"10px 16px",backgroundColor:"#eee",color:"#333",border:"1px solid #ccc",borderRadius:6},children:"목록으로"}),(0,i.jsxs)("div",{style:{display:"flex",gap:10},children:[s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:handleDelete,style:{backgroundColor:"#e74c3c",color:"#fff",padding:"10px 16px",border:"none",borderRadius:6},children:"삭제"}),(0,i.jsx)("button",{onClick:()=>h(!0),style:{backgroundColor:"#10b981",color:"#fff",padding:"10px 16px",border:"none",borderRadius:6},children:c.certificate_template?"수료증 수정":"수료증 등록"})]}),(0,i.jsx)("button",{onClick:handleSave,style:{padding:"10px 16px",backgroundColor:"#0070f3",color:"#fff",border:"none",borderRadius:6},children:"저장"})]})]})]}),u&&(0,i.jsx)(CertificateTemplateModal,{visible:u,onClose:()=>h(!1),onSave:handleSaveCertificateTemplate,initialValue:c.certificate_template})]})})}}},function(e){e.O(0,[3365,6911,1509,67,2206,9774,2888,179],function(){return e(e.s=3506)}),_N_E=e.O()}]);